<html lang="en"><head><script>(function(firebaseConfig, initialAuthToken, appId) {
        window.__firebase_config = firebaseConfig;
        window.__initial_auth_token = initialAuthToken;
        window.__app_id = appId;
            })("\n{\n  \"apiKey\": \"\",\n  \"authDomain\": \"bard-frontend.firebaseapp.com\",\n  \"projectId\": \"bard-frontend\",\n  \"storageBucket\": \"bard-frontend.firebasestorage.app\",\n  \"messagingSenderId\": \"175205271074\",\n  \"appId\": \"1:175205271074:web:2b7bd4d34d33bf38e6ec7b\"\n}\n","eyJhbGciOiJSUzI1NiIsImtpZCI6ImQ1OTQzZDdlNWZhYTIxZjcyOTJjMzI3MGY3ZDBjNWJmNDE5MjJmOTciLCJ0eXAiOiJKV1QifQ.eyJzdWIiOiJmaXJlYmFzZS1hZG1pbnNkay1mYnN2Y0BiYXJkLWZyb250ZW5kLmlhbS5nc2VydmljZWFjY291bnQuY29tIiwiYXVkIjoiaHR0cHM6Ly9pZGVudGl0eXRvb2xraXQuZ29vZ2xlYXBpcy5jb20vZ29vZ2xlLmlkZW50aXR5LmlkZW50aXR5dG9vbGtpdC52MS5JZGVudGl0eVRvb2xraXQiLCJ1aWQiOiIwODgwMDczMzM2MjY4MDczODE0OCIsImlzcyI6ImZpcmViYXNlLWFkbWluc2RrLWZic3ZjQGJhcmQtZnJvbnRlbmQuaWFtLmdzZXJ2aWNlYWNjb3VudC5jb20iLCJjbGFpbXMiOnsiYXBwSWQiOiJjX2E3YzI3NDM5OTk2NmM2NDJfd29ya3Nob3AuaHRtbC0zMTUifSwiZXhwIjoxNzcwMzAxODQwLCJpYXQiOjE3NzAyOTgyNDAsImFsZyI6IlJTMjU2In0.clZL2EZFfreq8t2fDZd4EPcGzLkw9QQGXB7LAqtyP2BiMxwaLjAOcqNnCCAUOc4_5n1SQrqLJXUMzf9HyX3o9Vn0pdE2M21GcNOC23ai-NqM3rkxxr8f1j859ryyF4Fn3vhJs3XKZ061gZBvkAsbMkRMkLApGr9QZIjFf39hyX7YbSU1smTy7UVwCB9HwA4u-j_jpv6-GvEz_nYgl73AkaSQFyTZi7COLbmIc6Qt28ZQG1HFtKddlnNUlOvNQB2H0yGBmjXFqJMNenxuCwV8COKI4KbYGvwW-_Ms8D5I87USDGN4C2uARWNCBcztCBmggXVqGVzcqr_UpXvOPmx7WQ","c_a7c274399966c642_workshop.html-315")</script><script>'use strict';var h=typeof Object.defineProperties=="function"?Object.defineProperty:function(a,b,d){if(a==Array.prototype||a==Object.prototype)return a;a[b]=d.value;return a};function l(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var b=0;b<a.length;++b){var d=a[b];if(d&&d.Math==Math)return d}throw Error("Cannot find global object");}var n=l(this);
function p(a,b){if(b)a:{var d=n;a=a.split(".");for(var c=0;c<a.length-1;c++){var e=a[c];if(!(e in d))break a;d=d[e]}a=a[a.length-1];c=d[a];b=b(c);b!=c&&b!=null&&h(d,a,{configurable:!0,writable:!0,value:b})}}function r(a){function b(c){return a.next(c)}function d(c){return a.throw(c)}return new Promise(function(c,e){function f(g){g.done?c(g.value):Promise.resolve(g.value).then(b,d).then(f,e)}f(a.next())})}function t(a){return r(a())}
p("Object.values",function(a){return a?a:function(b){var d=[],c;for(c in b)Object.prototype.hasOwnProperty.call(b,c)&&d.push(b[c]);return d}});p("Array.prototype.includes",function(a){return a?a:function(b,d){var c=this;c instanceof String&&(c=String(c));var e=c.length;d=d||0;for(d<0&&(d=Math.max(d+e,0));d<e;d++){var f=c[d];if(f===b||Object.is(f,b))return!0}return!1}});/*

 MIT License

 Copyright (c) 2017-2023 W.Y.

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated documentation files (the "Software"), to deal
 in the Software without restriction, including without limitation the rights
 to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 copies of the Software, and to permit persons to whom the Software is
 furnished to do so, subject to the following conditions:

 The above copyright notice and this permission notice shall be included in
 all copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 SOFTWARE.

*/
function u(a,b){const d=a.style;b.backgroundColor&&(d.backgroundColor=b.backgroundColor);b.width&&(d.width=`${b.width}px`);b.height&&(d.height=`${b.height}px`);const c=b.style;c!=null&&Object.keys(c).forEach(e=>{d[e]=c[e]})};var v=(()=>{let a=0;return()=>{a+=1;return`u${`0000${(Math.random()*1679616<<0).toString(36)}`.slice(-4)}${a}`}})();function w(a){const b=[];for(let d=0,c=a.length;d<c;d++)b.push(a[d]);return b}let x=null;function y(a={}){return x?x:a.l?x=a.l:x=w(window.getComputedStyle(document.documentElement))}function z(a,b){return(a=(a.ownerDocument.defaultView||window).getComputedStyle(a).getPropertyValue(b))?parseFloat(a.replace("px","")):0}
function A(a,b={}){var d;if(!(d=b.width)){d=z(a,"border-left-width");var c=z(a,"border-right-width");d=a.clientWidth+d+c}(b=b.height)||(b=z(a,"border-top-width"),c=z(a,"border-bottom-width"),b=a.clientHeight+b+c);return{width:d,height:b}}function B(a){return new Promise((b,d)=>{const c=new Image;c.onload=()=>{c.decode().then(()=>{requestAnimationFrame(()=>b(c))})};c.onerror=d;c.crossOrigin="anonymous";c.decoding="async";c.src=a})}
function C(a){return t(function*(){return Promise.resolve().then(()=>(new XMLSerializer).serializeToString(a)).then(encodeURIComponent).then(b=>`data:image/svg+xml;charset=utf-8,${b}`)})}
function D(a,b,d){return t(function*(){const c=document.createElementNS("http://www.w3.org/2000/svg","svg"),e=document.createElementNS("http://www.w3.org/2000/svg","foreignObject");c.setAttribute("width",`${b}`);c.setAttribute("height",`${d}`);c.setAttribute("viewBox",`0 0 ${b} ${d}`);e.setAttribute("width","100%");e.setAttribute("height","100%");e.setAttribute("x","0");e.setAttribute("y","0");e.setAttribute("externalResourcesRequired","true");c.appendChild(e);e.appendChild(a);return C(c)})}
var E=(a,b)=>{if(a instanceof b)return!0;a=Object.getPrototypeOf(a);return a===null?!1:a.constructor.name===b.name||E(a,b)};function F(a,b){return y(b).map(d=>{const c=a.getPropertyValue(d),e=a.getPropertyPriority(d);return`${d}: ${c}${e?" !important":""};`}).join(" ")}
function G(a,b,d,c){a=window.getComputedStyle(a,d);var e=a.getPropertyValue("content");if(e!==""&&e!=="none"){var f=v();try{b.className=`${b.className} ${f}`}catch(k){return}e=document.createElement("style");var g=e.appendChild;d=`.${f}:${d}`;a.cssText?(c=a.getPropertyValue("content"),c=`${a.cssText} content: '${c.replace(/'|"/g,"")}';`):c=F(a,c);g.call(e,document.createTextNode(`${d}{${c}}`));b.appendChild(e)}};function H(a){return a.search(/^(data:)/)!==-1}function I(a,b,d){return t(function*(){const c=yield fetch(a,b);if(c.status===404)throw Error(`Resource "${c.url}" not found`);const e=yield c.blob();return new Promise((f,g)=>{const k=new FileReader;k.onerror=g;k.onloadend=()=>{try{f(d({o:c,result:k.result}))}catch(m){g(m)}};k.readAsDataURL(e)})})}const J={};function K(a,b,d){let c=a.replace(/\?.*/,"");d&&(c=a);/ttf|otf|eot|woff2?/i.test(c)&&(c=c.replace(/.*\//,""));return b?`[${b}]${c}`:c}
function L(a,b,d){return t(function*(){const c=K(a,b,d.C);if(J[c]!=null)return J[c];d.u&&(a+=(/\?/.test(a)?"&":"?")+(new Date).getTime());let e;try{const f=yield I(a,d.i,({o:g,result:k})=>{b||(b=g.headers.get("Content-Type")||"");return k.split(/,/)[1]});e=`data:${b};base64,${f}`}catch(f){e=d.B||""}return J[c]=e})};const M={P:"application/font-woff",R:"application/font-woff",N:"application/font-truetype",v:"application/vnd.ms-fontobject",H:"image/png",F:"image/jpeg",D:"image/jpeg",A:"image/gif",M:"image/tiff",L:"image/svg+xml",O:"image/webp"};function N(a){return(a=/\.([^./]*?)$/g.exec(a))?a[1]:""};function O(a){return t(function*(){const b=a.toDataURL();return b==="data:,"?a.cloneNode(!1):B(b)})}function aa(a,b){return t(function*(){if(a.currentSrc){var d=document.createElement("canvas");const c=d.getContext("2d");d.width=a.clientWidth;d.height=a.clientHeight;c==null||c.drawImage(a,0,0,d.width,d.height);d=d.toDataURL();return B(d)}d=a.poster;d=yield L(d,M[N(d).toLowerCase()]||"",b);return B(d)})}
function ba(a,b){return t(function*(){try{let d;if(a==null?0:(d=a.contentDocument)==null?0:d.body)return yield P(a.contentDocument.body,b,!0)}catch(d){}return a.cloneNode(!1)})}function ca(a,b){return t(function*(){return E(a,HTMLCanvasElement)?O(a):E(a,HTMLVideoElement)?aa(a,b):E(a,HTMLIFrameElement)?ba(a,b):a.cloneNode(a.tagName!=null&&a.tagName.toUpperCase()==="SVG")})}
function da(a,b,d){return t(function*(){if(b.tagName!=null&&b.tagName.toUpperCase()==="SVG")return b;let c=[];if(a.tagName!=null&&a.tagName.toUpperCase()==="SLOT"&&a.assignedNodes)c=w(a.assignedNodes());else{let e;if(E(a,HTMLIFrameElement)&&((e=a.contentDocument)==null?0:e.body))c=w(a.contentDocument.body.childNodes);else{let f;c=w(((f=a.shadowRoot)!=null?f:a).childNodes)}}if(c.length===0||E(a,HTMLVideoElement))return b;yield c.reduce((e,f)=>e.then(()=>P(f,d)).then(g=>{g&&b.appendChild(g)}),Promise.resolve());
return b})}function ea(a,b,d){const c=b.style;if(c){var e=window.getComputedStyle(a);e.cssText?(c.cssText=e.cssText,c.transformOrigin=e.transformOrigin):y(d).forEach(f=>{let g=e.getPropertyValue(f);f==="font-size"&&g.endsWith("px")&&(g=`${Math.floor(parseFloat(g.substring(0,g.length-2)))-.1}px`);E(a,HTMLIFrameElement)&&f==="display"&&g==="inline"&&(g="block");f==="d"&&b.getAttribute("d")&&(g=`path(${b.getAttribute("d")})`);c.setProperty(f,g,e.getPropertyPriority(f))})}}
function fa(a,b){E(a,HTMLSelectElement)&&(b=Array.from(b.children).find(d=>a.value===d.getAttribute("value")))&&b.setAttribute("selected","")}
function ha(a,b){return t(function*(){var d=a.querySelectorAll?a.querySelectorAll("use"):[];if(d.length===0)return a;var c={};for(var e=0;e<d.length;e++){var f=d[e].getAttribute("xlink:href");if(f){const g=document.querySelector(f);a.querySelector(f)||!g||c[f]||(c[f]=yield P(g,b,!0))}}d=Object.values(c);if(d.length){c=document.createElementNS("http://www.w3.org/1999/xhtml","svg");c.setAttribute("xmlns","http://www.w3.org/1999/xhtml");c.style.position="absolute";c.style.width="0";c.style.height="0";
c.style.overflow="hidden";c.style.display="none";e=document.createElementNS("http://www.w3.org/1999/xhtml","defs");c.appendChild(e);for(f=0;f<d.length;f++)e.appendChild(d[f]);a.appendChild(c)}return a})}
function P(a,b,d){return t(function*(){return d||!b.filter||b.filter(a)?Promise.resolve(a).then(c=>ca(c,b)).then(c=>da(a,c,b)).then(c=>{E(c,Element)&&(ea(a,c,b),G(a,c,":before",b),G(a,c,":after",b),E(a,HTMLTextAreaElement)&&(c.textContent=a.value),E(a,HTMLInputElement)&&c.setAttribute("value",a.value),fa(a,c));return c}).then(c=>ha(c,b)):null})};const Q=/url\((['"]?)([^'"]+?)\1\)/g,ia=/url\([^)]+\)\s*format\((["']?)([^"']+)\1\)/g,ja=/src:\s*(?:url\([^)]+\)\s*format\([^)]+\)[,;]\s*)+/g;function ka(a){const b=[];a.replace(Q,(d,c,e)=>{b.push(e);return d});return b.filter(d=>!H(d))}
function la(a,b,d,c){return t(function*(){try{const e=d?(new URL(b,d||void 0)).toString():b;let f;f=yield L(e,M[N(b).toLowerCase()]||"",c);return a.replace(new RegExp(`(url\\(['"]?)(${b.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1")})(['"]?\\))`,"g"),`$1${f}$3`)}catch(e){}return a})}function ma(a,{I:b}){return b?a.replace(ja,d=>{for(;;){const [c,,e]=ia.exec(d)||[],f=c,g=e;if(!g)return"";if(g===b)return`src: ${f};`}}):a}
function R(a,b,d){return t(function*(){if(a.search(Q)===-1)return a;const c=ma(a,d);return ka(c).reduce((e,f)=>e.then(g=>la(g,f,b,d)),Promise.resolve(c))})};function S(a,b,d){return t(function*(){var c;const e=(c=b.style)==null?void 0:c.getPropertyValue(a);return e?(c=yield R(e,null,d),b.style.setProperty(a,c,b.style.getPropertyPriority(a)),!0):!1})}function na(a,b){return t(function*(){(yield S("background",a,b))||(yield S("background-image",a,b));(yield S("mask",a,b))||(yield S("-webkit-mask",a,b))||(yield S("mask-image",a,b))||(yield S("-webkit-mask-image",a,b))})}
function oa(a,b){return t(function*(){const d=E(a,HTMLImageElement);if(d&&!H(a.src)||E(a,SVGImageElement)&&!H(a.href.baseVal)){var c=d?a.src:a.href.baseVal,e=yield L(c,M[N(c).toLowerCase()]||"",b);yield new Promise((f,g)=>{a.onload=f;a.onerror=b.m?(...k)=>{try{f(b.m(...k))}catch(m){g(m)}}:g;a.decode&&(a.decode=f);a.loading==="lazy"&&(a.loading="eager");d?(a.srcset="",a.src=e):a.href.baseVal=e})}})}
function pa(a,b){return t(function*(){const d=w(a.childNodes).map(c=>T(c,b));yield Promise.all(d).then(()=>a)})}function T(a,b){return t(function*(){E(a,Element)&&(yield na(a,b),yield oa(a,b),yield pa(a,b))})};const U={};function V(a){return t(function*(){var b=U[a];if(b!=null)return b;b=yield(yield fetch(a)).text();b={url:a,cssText:b};return U[a]=b})}function W(a,b){return t(function*(){let d=a.cssText;const c=/url\(["']?([^"')]+)["']?\)/g,e=(d.match(/url\([^)]+\)/g)||[]).map(f=>t(function*(){let g=f.replace(c,"$1");g.startsWith("https://")||(g=(new URL(g,a.url)).href);return I(g,b.i,({result:k})=>{d=d.replace(f,`url(${k})`);return[f,k]})}));return Promise.all(e).then(()=>d)})}
function X(a){if(a==null)return[];const b=[];a=a.replace(/(\/\*[\s\S]*?\*\/)/gi,"");for(var d=RegExp("((@.*?keyframes [\\s\\S]*?){([\\s\\S]*?}\\s*?)})","gi");;){var c=d.exec(a);if(c===null)break;b.push(c[0])}a=a.replace(d,"");d=/@import[\s\S]*?url\([^)]*\)[\s\S]*?;/gi;for(c=RegExp("((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})","gi");;){let e=d.exec(a);if(e===null)if(e=c.exec(a),e===null)break;else d.lastIndex=c.lastIndex;else c.lastIndex=
d.lastIndex;b.push(e[0])}return b}
function qa(a,b){return t(function*(){const d=[],c=[];a.forEach(e=>{if("cssRules"in e)try{w(e.cssRules||[]).forEach((f,g)=>{if(f.type===CSSRule.IMPORT_RULE){let k=g+1;f=V(f.href).then(m=>W(m,b)).then(m=>X(m).forEach(q=>{try{e.insertRule(q,q.startsWith("@import")?k+=1:e.cssRules.length)}catch(Da){}})).catch(()=>{});c.push(f)}})}catch(f){const g=a.find(k=>k.href==null)||document.styleSheets[0];e.href!=null&&c.push(V(e.href).then(k=>W(k,b)).then(k=>X(k).forEach(m=>{g.insertRule(m,g.cssRules.length)})).catch(()=>
{}))}});return Promise.all(c).then(()=>{a.forEach(e=>{if("cssRules"in e)try{w(e.cssRules||[]).forEach(f=>{d.push(f)})}catch(f){}});return d})})}function ra(a){return a.filter(b=>b.type===CSSRule.FONT_FACE_RULE).filter(b=>b.style.getPropertyValue("src").search(Q)!==-1)}function sa(a,b){return t(function*(){if(a.ownerDocument==null)throw Error("Provided element is not within a Document");var d=w(a.ownerDocument.styleSheets);d=yield qa(d,b);return ra(d)})}
function ta(a){function b(c){(c.style.fontFamily||getComputedStyle(c).fontFamily).split(",").forEach(e=>{d.add(e.trim().replace(/["']/g,""))});Array.from(c.children).forEach(e=>{e instanceof HTMLElement&&b(e)})}const d=new Set;b(a);return d}function ua(a,b){return t(function*(){const d=yield sa(a,b),c=ta(a);return(yield Promise.all(d.filter(e=>c.has(e.style.fontFamily.trim().replace(/["']/g,""))).map(e=>R(e.cssText,e.parentStyleSheet?e.parentStyleSheet.href:null,b)))).join("\n")})}
function va(a,b){return t(function*(){const d=b.j!=null?b.j:b.K?null:yield ua(a,b);if(d){const c=document.createElement("style");c.appendChild(document.createTextNode(d));a.firstChild?a.insertBefore(c,a.firstChild):a.appendChild(c)}})};function wa(a,b={}){return t(function*(){const {width:d,height:c}=A(a,b),e=yield P(a,b,!0);yield va(e,b);yield T(e,b);u(e,b);return yield D(e,d,c)})}
function xa(a,b={}){return t(function*(){const {width:d,height:c}=A(a,b);var e=yield wa(a,b);e=yield B(e);const f=document.createElement("canvas"),g=f.getContext("2d"),k=b.G||window.devicePixelRatio||1,m=b.h||d,q=b.g||c;f.width=m*k;f.height=q*k;!b.J&&(f.width>16384||f.height>16384)&&(f.width>16384&&f.height>16384?f.width>f.height?(f.height*=16384/f.width,f.width=16384):(f.width*=16384/f.height,f.height=16384):f.width>16384?(f.height*=16384/f.width,f.width=16384):(f.width*=16384/f.height,f.height=
16384));f.style.width=`${m}`;f.style.height=`${q}`;b.backgroundColor&&(g.fillStyle=b.backgroundColor,g.fillRect(0,0,f.width,f.height));g.drawImage(e,0,0,f.width,f.height);return f})}function ya(a,b={}){return t(function*(){return(yield xa(a,b)).toDataURL()})};const za=["gemini.google.com","corp.google.com","proxy.googlers.com"];function Y(){return document.body.querySelectorAll('[class*="animate"]').length>0}function Z(a){return t(function*(){try{return yield ya(a,{h:a.offsetWidth,g:a.offsetHeight})}catch(d){var b=a.offsetHeight;const c=document.createElement("canvas");c.width=a.offsetWidth;c.height=b;return c.toDataURL("image/png")}})}
function Aa(){return t(function*(){const a=document.body.offsetWidth,b=document.body.offsetHeight,d=document.body.cloneNode(!0);d.querySelectorAll('[class*="animate"]').forEach(c=>{c.classList.remove(...Array.from(c.classList).filter(e=>e.startsWith("animate")))});d.style.width=`${a}px`;d.style.height=`${b}px`;return d})}
function Ba(a){return t(function*(){let b=document.body;if(Y()){var d=yield Aa();b=d;document.body.appendChild(d)}d=yield Z(b);Y()&&document.body.removeChild(b);window.parent.postMessage({type:"SEND_SCREENSHOT",image:d,topOffset:document.documentElement.scrollTop},a.origin)})}function Ca(a){return t(function*(){const b={type:"SEND_SCREENSHOT_FOR_DATA_VISUALIZATION",image:yield Z(document.body),topOffset:0};window.parent.postMessage(b,a.origin)})}
window.addEventListener("message",a=>t(function*(){if(za.some(d=>a.origin.includes(d))){var b=a.data;b&&(b.type==="MAKE_SCREENSHOT"&&(yield Ba(a)),b.type==="MAKE_SCREENSHOT_FOR_DATA_VISUALIZATION"&&(yield Ca(a)))}}));
</script><script>(function() {
  // Ensure this script is executed only once
  if (window.firebaseAuthBridgeScriptLoaded) {
    return;
  }
  window.firebaseAuthBridgeScriptLoaded = true;

  let nextTokenPromiseId = 0;

  // Stores { resolve, reject } for ongoing token requests
  const pendingTokenPromises = {};

  // Listen for messages from the Host Application
  window.addEventListener('message', function(event) {

    const messageData = event.data;

  if (messageData && messageData.type === 'RESOLVE_NEW_FIREBASE_TOKEN') {
      const { success, token, error, promiseId } = messageData ?? {};
      if (pendingTokenPromises[promiseId]) {
        if (success) {
          pendingTokenPromises[promiseId].resolve(token);
        } else {
          pendingTokenPromises[promiseId].reject(new Error(error || 'Token refresh failed from host.'));
        }
        delete pendingTokenPromises[promiseId];
      }
    }
  });

  // Expose a function for the Generated App to request a new Firebase token
  window.requestNewFirebaseToken = function() {
    const currentPromiseId = nextTokenPromiseId++;
    const promise = new Promise((resolve, reject) => {
      pendingTokenPromises[currentPromiseId] = { resolve, reject };
    });
    if (window.parent && window.parent !== window) {
      window.parent.postMessage({
        type: 'REQUEST_NEW_FIREBASE_TOKEN',
        promiseId: currentPromiseId
      }, '*');
    } else {
      pendingTokenPromises[currentPromiseId].reject(new Error('No parent window to request token from.'));
      delete pendingTokenPromises[currentPromiseId];
    }
    return promise;
  };
})();</script><script>
let realOriginalGetUserMedia = null;
if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
  realOriginalGetUserMedia = navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);
}

(function() {
  if (navigator.mediaDevices && navigator.mediaDevices.__proto__) {
    try {
      Object.defineProperty(navigator.mediaDevices.__proto__, 'getUserMedia', {
        get: function() {
          return undefined; // Or throw an error
        },
        configurable: false
      });
    } catch (error) {
      console.error("Error defining prototype getter:", error);
    }
  }
})();

(function() {
  const pendingMediaResolvers = {};
  let nextMediaPromiseId = 0;

  function requestMediaPermissions(constraints) {
    const mediaPromiseId = nextMediaPromiseId++;
    const promise = new Promise((resolve, reject) => {
      pendingMediaResolvers[mediaPromiseId] = (granted) => {
        delete pendingMediaResolvers[mediaPromiseId];
        resolve(granted);
      };
    });

    window.parent.postMessage({
      type: 'requestMediaPermission',
      constraints: constraints,
      promiseId: mediaPromiseId,
    }, '*');

    return promise;
  }

  let originalGetUserMedia = realOriginalGetUserMedia;

  function interceptGetUserMedia() {
    if (navigator.mediaDevices) {
      Object.defineProperty(navigator.mediaDevices, 'getUserMedia', {
        value: function(constraints) {
          return requestMediaPermissions(constraints).then((granted) => {
            if (granted) {
              if (originalGetUserMedia) {
                return originalGetUserMedia(constraints);
              } else {
                throw new Error("Original getUserMedia not available.");
              }
            } else {
              throw new DOMException('Permission denied', 'NotAllowedError');
            }
          });
        },
        writable: false,
        configurable: false
      });
    }
  }

  interceptGetUserMedia();

  const observer = new MutationObserver(function(mutationsList, observer) {
    for (const mutation of mutationsList) {
      if (mutation.type === 'reconfigured' && mutation.name === 'getUserMedia' && mutation.object === navigator.mediaDevices) {
        interceptGetUserMedia();
      } else if (mutation.type === 'attributes' && mutation.attributeName === 'getUserMedia' && mutation.target === navigator.mediaDevices) {
        interceptGetUserMedia();
      } else if (mutation.type === 'childList' && mutation.addedNodes) {
        mutation.addedNodes.forEach(node => {
          if (node === navigator.mediaDevices) {
            interceptGetUserMedia();
          }
        });
      }
    }
  });

  function interceptSpeechRecognition() {
    if (!window.SpeechRecognition && !window.webkitSpeechRecognition) {
      return;
    }

    const OriginalSpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;

    const SpeechRecognitionWrapper = function(...args) {
      const recognizer = new OriginalSpeechRecognition(...args);
      const originalStart = recognizer.start.bind(recognizer);

      recognizer.start = function() {
        requestMediaPermissions({ audio: true }).then(granted => {
          if (granted) {
            originalStart();
          } else {
            const errorEvent = new SpeechRecognitionErrorEvent('error');
            errorEvent.error = 'not-allowed'; // This is the standard error for permission denial.
            recognizer.dispatchEvent(errorEvent);
          }
        });
      };

      return recognizer;
    };

    SpeechRecognitionWrapper.prototype = OriginalSpeechRecognition.prototype;
    SpeechRecognitionWrapper.prototype.constructor = SpeechRecognitionWrapper;

    if (window.SpeechRecognition) {
      window.SpeechRecognition = SpeechRecognitionWrapper;
    }
    if (window.webkitSpeechRecognition) {
      window.webkitSpeechRecognition = SpeechRecognitionWrapper;
    }
  }

  interceptSpeechRecognition();

  window.addEventListener('message', function(event) {
    if (event.data) {
      if (event.data.type === 'resolveMediaPermission') {
        const { promiseId, granted } = event.data;
        if (pendingMediaResolvers[promiseId]) {
          pendingMediaResolvers[promiseId](granted);
        }
      }
    }
  });

})();</script><script>((function(modelInformation) {
  const originalFetch = window.fetch;
  // TODO: b/421908508 - Move these out of the script and match all generative AI model calls.
  let googleLlmBaseApiUrls = [
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.textModelName + ':streamGenerateContent',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.textModelName + ':generateContent',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.imageModelName + ':predict',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.imageModelName + ':predictLongRunning',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.imageEditModelName + ':generateContent',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.imageTransformModelName + ':generateContent',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.videoModelName + ':predict',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.videoModelName + ':predictLongRunning',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.ttsModelName + ':generateContent',
  ];
  modelInformation.deprecatedTextModelNames.forEach((modelName) => {
    googleLlmBaseApiUrls.push(
      'https://generativelanguage.googleapis.com/v1beta/models/' + modelName + ':streamGenerateContent',
      'https://generativelanguage.googleapis.com/v1beta/models/' + modelName + ':generateContent',
    );
  });
  modelInformation.deprecatedImageModelNames.forEach((modelName) => {
    googleLlmBaseApiUrls.push(
      'https://generativelanguage.googleapis.com/v1beta/models/' + modelName + ':predict',
      'https://generativelanguage.googleapis.com/v1beta/models/' + modelName + ':predictLongRunning',
    );
  });

  const pendingFetchResolvers = {};
  let nextPromiseId = 0;

  function handleStringInput(input, optionsArgument) {
    const actualUrl = input;
    const fetchCallArgs = [actualUrl, optionsArgument];
    const effectiveOptions = optionsArgument || {};
    const bodyForApiKeyCheck = effectiveOptions.body;
    const bodyForPostMessage = effectiveOptions.body;
    return { actualUrl, fetchCallArgs, effectiveOptions, bodyForApiKeyCheck, bodyForPostMessage };
  }

  function handleRequestInput(input, optionsArgument) {
    const actualUrl = input.url;
    const fetchCallArgs = [input, optionsArgument];
    const effectiveOptions = { method: input.method, headers: new Headers(input.headers) };
    let bodyForApiKeyCheck;
    let bodyForPostMessage;

    if (optionsArgument) {
      if (optionsArgument.method) effectiveOptions.method = optionsArgument.method;
      if (optionsArgument.headers) effectiveOptions.headers = new Headers(optionsArgument.headers);
      if ('body' in optionsArgument) {
        bodyForApiKeyCheck = optionsArgument.body;
        bodyForPostMessage = optionsArgument.body;
      } else {
        bodyForApiKeyCheck = undefined;
        bodyForPostMessage = input.body;
      }
    } else {
      bodyForApiKeyCheck = undefined;
      bodyForPostMessage = input.body;
    }
    return { actualUrl, fetchCallArgs, effectiveOptions, bodyForApiKeyCheck, bodyForPostMessage };
  }

  window.fetch = function(input, optionsArgument) {
    let actualUrl;
    let fetchCallArgs;
    let effectiveOptions = {};
    let bodyForApiKeyCheck;
    let bodyForPostMessage;

    if (typeof input === 'string') {
      ({actualUrl, fetchCallArgs, effectiveOptions, bodyForApiKeyCheck, bodyForPostMessage} = handleStringInput(input, optionsArgument));
    } else if (input instanceof Request) {
      ({actualUrl, fetchCallArgs, effectiveOptions, bodyForApiKeyCheck, bodyForPostMessage} = handleRequestInput(input, optionsArgument));
    } else {
      return originalFetch.apply(window, [input, optionsArgument]);
    }

    effectiveOptions.method = effectiveOptions.method || 'GET';
    if (!effectiveOptions.headers) {
      effectiveOptions.headers = new Headers();
    }


    if (typeof actualUrl === 'string' && googleLlmBaseApiUrls.some((url) => actualUrl.startsWith(url))) {
      let apiKeyIsNull = true;

      const regex = new RegExp("models/([^:]+)");
      const modelNameMatch = actualUrl.match(regex);
      const modelName = modelNameMatch ? modelNameMatch[1] : 'unspecified';


      try {
        const urlObject = new URL(actualUrl);  // Use URL object for robust parsing
        const apiKeyParam = urlObject.searchParams.get('key');
        if (apiKeyParam) {
          apiKeyIsNull = false;
        }
      } catch (e) {
        // Continue checks even if URL parsing fails
      }

      if (apiKeyIsNull && effectiveOptions.headers) {
        const h = new Headers(effectiveOptions.headers);
        const apiKeyHeaderValue = h.get('X-API-Key') || h.get('x-api-key');
        if (apiKeyHeaderValue) {
          apiKeyIsNull = false;
          return originalFetch.apply(window, fetchCallArgs);
        }
      }

      if (apiKeyIsNull && effectiveOptions.method && ['POST', 'PUT', 'PATCH'].includes(effectiveOptions.method.toUpperCase()) && typeof bodyForApiKeyCheck === 'string') {
        try {
          const bodyData = JSON.parse(bodyForApiKeyCheck);
          if (bodyData && bodyData.apiKey) {
            apiKeyIsNull = false;
            return originalFetch.apply(window, fetchCallArgs);
          }
        } catch (e) {
          // Ignore JSON parsing errors
        }
      }

      if(apiKeyIsNull) {
        const promiseId = nextPromiseId++;
        const promise = new Promise((resolve) => {
          pendingFetchResolvers[promiseId] = (resolvedResponse) => {
            delete pendingFetchResolvers[promiseId];
            resolve(resolvedResponse);
          };
        });

        let serializedBodyForPostMessage;
        if (typeof bodyForPostMessage === 'string' || bodyForPostMessage == null) {
            serializedBodyForPostMessage = bodyForPostMessage;
        } else if (bodyForPostMessage instanceof ReadableStream) {
            serializedBodyForPostMessage = null;
        } else {
            try {
                serializedBodyForPostMessage = JSON.stringify(bodyForPostMessage);
            } catch (e) {
                serializedBodyForPostMessage = null;
            }
        }

        const messageOptions = {
            method: effectiveOptions.method,
            headers: Object.fromEntries(new Headers(effectiveOptions.headers).entries()),
            body: serializedBodyForPostMessage
        };

        window.parent.postMessage({
          type: 'requestFetch',
          url: actualUrl,
          modelName: modelName,
          options: messageOptions,
          promiseId: promiseId,
        }, '*');

        return promise;
      }
      return originalFetch.apply(window, fetchCallArgs);
    }
    return originalFetch.apply(window, fetchCallArgs);
  };

  window.addEventListener('message', function(event) {
    if (event.data && event.data.type === 'resolveFetch') {
      const { promiseId, response } = event.data;
      if (pendingFetchResolvers[promiseId]) {
        try {
          const reconstructedResponse = new Response(response.body, {
            status: response.status,
            statusText: response.statusText,
            headers: new Headers(response.headers),
          });
          pendingFetchResolvers[promiseId](reconstructedResponse);
        } catch (error) {
          pendingFetchResolvers[promiseId](new Response(null, { status: 500, statusText: "Interceptor Response Reconstruction Error" }));
        }
      }
    }
  });

}))({"textModelName":"gemini-2.5-flash-preview-09-2025","imageModelName":"imagen-4.0-generate-001","imageEditModelName":"gemini-2.5-flash-image-preview","imageTransformModelName":"gemini-3-pro-image-preview-11-2025","videoModelName":"veo-2.0-generate-001","ttsModelName":"gemini-2.5-flash-preview-tts","deprecatedTextModelNames":["gemini-2.0-flash","gemini-2.5-flash-preview-04-17","gemini-2.5-flash-preview-05-20"],"deprecatedImageModelNames":["imagen-3.0-generate-001","imagen-3.0-generate-002"]})</script><script>(function() {
  const originalConsoleLog = console.log;
  const originalConsoleError = console.error;

    /**
   * Normalizes an error event or a promise rejection reason into a structured error object.
   * @param {*} errorEventOrReason The error object or reason.
   * @return {object} Structured error data { message, name, stack }.
   */
  function getErrorObject(errorEventOrReason) {
    if (errorEventOrReason instanceof Error) {
      return {
        message: errorEventOrReason.message,
        name: errorEventOrReason.name,
        stack: errorEventOrReason.stack,
      };
    }
    // Fallback for non-Error objects.
    try {
      return {
        message: JSON.stringify(errorEventOrReason),
        name: 'UnknownErrorType',
        stack: null,
      };
    } catch (e) {
      return {
        message: String(errorEventOrReason),
        name: 'UnknownErrorTypeNonStringifiable',
        stack: null,
      };
    }
  }

  /**
   * Converts an array of arguments (from log/error) into a single string.
   * Handles Error objects specially to include their message and stack.
   * @param {Array<*>} args - Arguments passed to console methods.
   * @return {string} A string representation of the arguments.
   */
  function stringifyArgs(args) {
    return args
      .map((arg) => {
        if (arg instanceof Error) {
          const {message, stack} = arg;
          return `Error: ${message}${stack ? ('\nStack: ' + stack) : ''}`;
        }
        if (typeof arg === 'object' && arg !== null) {
          try {
            return JSON.stringify(arg);
          } catch (error) {
            return '[Circular Object]';
          }
        } else {
          return String(arg);
        }
      })
      .join(' ');
  }

  console.log = function(...args) {
    const logString = stringifyArgs(args);
    window.parent.postMessage({ type: 'log', message: logString }, '*');
    originalConsoleLog.apply(console, args);
  };

  console.error = function(...args) {
    let errorData;
    if (args.length > 0 && args[0] instanceof Error) {
      const err = args[0];
      // If the first arg is an Error, capture its details.
      errorData = {
        type: 'error',
        source: 'CONSOLE_ERROR',
        ...getErrorObject(err),
        rawArgsString: stringifyArgs(args.slice(1)),
        timestamp: new Date().toISOString(),
      };
    } else {
      // If not an Error object, treat all args as a general error message.
      errorData = {
        type: 'error',
        source: 'CONSOLE_ERROR',
        message: stringifyArgs(args),
        name: 'ConsoleLoggedError',
        stack: null,
        timestamp: new Date().toISOString(),
      };
    }
    window.parent.postMessage(errorData, '*');
    originalConsoleError.apply(console, args);
  };

  // Listen for global unhandled synchronous errors.
  window.addEventListener('error', function(event) {
    const errorDetails = event.error ? getErrorObject(event.error) : {
      message: event.message,
      name: 'GlobalError',
      stack: null,
      filename: event.filename,
      lineno: event.lineno,
      colno: event.colno,
    };

    window.parent.postMessage({
      type: 'error',
      source: 'global',
      ...errorDetails,
      message: errorDetails.message || event.message,
      timestamp: new Date().toISOString(),
    }, '*');
  });

  // Listen for unhandled promise rejections (asynchronous errors).
  window.addEventListener('unhandledrejection', function(event) {
    const errorDetails = getErrorObject(event.reason);

    window.parent.postMessage({
      type: 'error',
      source: 'unhandledrejection',
      ...errorDetails,
      message: errorDetails.message || 'Unhandled Promise Rejection',
      timestamp: new Date().toISOString(),
    }, '*');
  });

})();</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>From Script to System: Workshop</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&amp;family=JetBrains+Mono:wght@400;700&amp;display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #0f172a;       /* Deep Navy */
            --text-color: #f1f5f9;     /* Off-white */
            --accent: #38bdf8;         /* Sky Blue */
            --accent-secondary: #818cf8; /* Indigo */
            --code-bg: #1e293b;        /* Darker Navy */
            --success: #34d399;        /* Emerald */
            --danger: #f87171;         /* Red */
            --warning: #fbbf24;        /* Amber */
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* Prevent horizontal overflow */
        html, body {
            max-width: 100%;
            overflow-x: hidden;
        }

        /* Ensure all containers respect viewport width */
        div, section, article {
            max-width: 100%;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            overflow: hidden;
            height: 100vh;
            width: 100vw;
            max-width: 100%;
        }

        /* Slide Container */
        .slide-deck {
            position: relative;
            width: 100%;
            height: 100%;
            max-width: 100vw;
            overflow: hidden;
        }

        .slide {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.5s ease;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 2rem 4rem;
            overflow-x: hidden;
            overflow-y: auto;
            max-width: 100%;
        }

        .slide.active {
            opacity: 1;
            visibility: visible;
            z-index: 10;
        }

        /* Fragments (Hidden Elements) */
        .fragment {
            opacity: 0;
            visibility: hidden;
            transform: translateY(20px);
            transition: all 0.5s cubic-bezier(0.25, 0.8, 0.25, 1);
        }

        .fragment.visible {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        /* Typography */
        h1 { font-size: 4rem; font-weight: 800; letter-spacing: -2px; background: linear-gradient(135deg, var(--accent), var(--accent-secondary)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 1rem; text-align: center; word-wrap: break-word; }
        h2 { font-size: 2.2rem; margin-bottom: 1.5rem; color: var(--accent); width: 100%; text-align: left; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 0.5rem; word-wrap: break-word; }
        h3 { font-size: 1.5rem; color: var(--accent-secondary); margin-bottom: 1rem; text-transform: uppercase; letter-spacing: 2px; word-wrap: break-word; }
        p, li { font-size: 1rem; line-height: 1.5; color: #cbd5e1; word-wrap: break-word; overflow-wrap: break-word; }
        
        /* Layouts */
        .intro-slide {
            text-align: center;
        }
        
        /* New Split Grid Layout */
        .split-grid {
            display: grid;
            grid-template-columns: 45% 1fr;
            grid-template-areas: "left right";
            gap: 2rem;
            width: 100%;
            height: calc(100vh - 180px); /* Full height minus padding/controls */
            max-width: 1600px;
            align-items: stretch;
            overflow: hidden;
        }

        .left-stack {
            grid-area: left;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            height: 100%;
            overflow-y: auto; /* Allow scroll for stacked items */
            overflow-x: hidden;
            min-width: 0; /* Prevent grid blowout */
            padding-right: 5px; /* Space for scrollbar */
        }

        /* Left stack items should not expand to fill height */
        .left-stack .grid-item {
            flex: 0 0 auto; /* Don't grow or shrink, use content size */
            max-height: 45vh; /* Limit individual item height for better scrolling */
        }

        /* Right stack should fill remaining space */
        .right-stack .grid-item {
            overflow-y: auto; /* Enable scrolling for code result */
        }

        .right-stack {
            grid-area: right;
            display: flex;
            flex-direction: column;
            height: 100%;
            overflow-x: hidden;
            min-width: 0; /* Prevent grid blowout */
        }

        .grid-item {
            background: rgba(255,255,255,0.03);
            padding: 1.5rem;
            border-radius: 12px;
            border: 1px solid rgba(255,255,255,0.05);
            display: flex;
            flex-direction: column;
            overflow-y: auto; /* Allow scrolling within grid items */
            overflow-x: hidden;
            word-wrap: break-word;
            overflow-wrap: break-word;
            max-height: 100%; /* Prevent overflow from parent */
        }

        .right-stack .grid-item {
            flex-grow: 1; /* Fill available space */
            max-height: 100%; /* Constrain to parent height */
        }

        .grid-title {
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 700;
            color: #64748b;
            margin-bottom: 0.5rem;
            display: block;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        /* Ensure all text content can break properly */
        .grid-item p, .grid-item li, .grid-item div {
            word-wrap: break-word;
            overflow-wrap: break-word;
            word-break: break-word;
            max-width: 100%;
        }

        /* Custom Scrollbar Styling */
        .left-stack::-webkit-scrollbar,
        .right-stack::-webkit-scrollbar,
        .grid-item::-webkit-scrollbar,
        .code-block::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        .left-stack::-webkit-scrollbar-track,
        .right-stack::-webkit-scrollbar-track,
        .grid-item::-webkit-scrollbar-track,
        .code-block::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 4px;
        }

        .left-stack::-webkit-scrollbar-thumb,
        .right-stack::-webkit-scrollbar-thumb,
        .grid-item::-webkit-scrollbar-thumb,
        .code-block::-webkit-scrollbar-thumb {
            background: rgba(56, 189, 248, 0.3);
            border-radius: 4px;
        }

        .left-stack::-webkit-scrollbar-thumb:hover,
        .right-stack::-webkit-scrollbar-thumb:hover,
        .grid-item::-webkit-scrollbar-thumb:hover,
        .code-block::-webkit-scrollbar-thumb:hover {
            background: rgba(56, 189, 248, 0.5);
        }

        /* Content Specifics */
        .concept-box { border-left: 4px solid var(--accent); }
        .prompt-box { border-left: 4px solid var(--accent-secondary); }
        .result-box { border-left: 4px solid var(--success); }
        .reflection-box { border-left: 4px solid var(--danger); }
        
        .reflection-box.positive { border-left: 4px solid var(--success); }
        .reflection-box.neutral { border-left: 4px solid var(--warning); }

        /* Code Blocks */
        .code-block {
            font-family: 'JetBrains Mono', monospace;
            background: var(--code-bg);
            padding: 1rem;
            border-radius: 6px;
            font-size: 0.85rem;
            color: #e2e8f0;
            overflow-x: auto;
            overflow-y: auto;
            max-height: 100%; /* Fill parent container but allow scrolling */
            min-height: 200px; /* Minimum readable height */
            white-space: pre-wrap;
            word-wrap: break-word;
            overflow-wrap: break-word;
            flex: 1 1 auto; /* Allow flexible sizing */
            max-width: 100%;
        }
        
        .keyword { color: #c084fc; }
        .string { color: #34d399; }
        .comment { color: #64748b; font-style: italic; }
        .func { color: #60a5fa; }

        /* Navigation Controls */
        .controls {
            position: absolute;
            bottom: 2rem;
            right: 2rem;
            display: flex;
            gap: 1rem;
            z-index: 100;
        }
        button {
            background: rgba(255,255,255,0.1);
            border: none;
            color: white;
            padding: 0.8rem 1.2rem;
            border-radius: 50px;
            cursor: pointer;
            transition: background 0.3s;
            font-weight: 600;
        }
        button:hover { background: var(--accent); color: var(--bg-color); }

        .progress-bar {
            position: absolute;
            bottom: 0;
            left: 0;
            height: 6px;
            background: var(--accent);
            width: 0%;
            transition: width 0.3s;
        }

        /* Specific Visuals */
        .tag {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 50px;
            font-size: 0.8rem;
            font-weight: 700;
            margin-right: 1rem;
            vertical-align: middle;
        }
        .tag.phase1 { background: rgba(56, 189, 248, 0.2); color: var(--accent); }
        .tag.phase2 { background: rgba(129, 140, 248, 0.2); color: var(--accent-secondary); }
        .tag.phase3 { background: rgba(52, 211, 153, 0.2); color: var(--success); }

        /* Tips Grid */
        .tips-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            width: 100%;
            max-width: 1400px;
            margin-top: 1rem;
            max-height: 80vh;
            overflow-y: auto;
            padding-right: 10px; /* Space for scrollbar */
        }
        
        /* Interactive Tip Card */
        .tip-card {
            background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.08);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .tip-card:hover {
            border-color: rgba(255,255,255,0.3);
            background: rgba(255,255,255,0.05);
        }

        .tip-header {
            padding: 0.9rem;
            display: flex;
            gap: 0.8rem;
            align-items: center;
        }

        .tip-body {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s cubic-bezier(0.25, 0.8, 0.25, 1), opacity 0.4s ease;
            opacity: 0;
            background: rgba(0,0,0,0.3);
        }

        .tip-card.open .tip-body {
            max-height: 500px; /* Large enough for content expansion */
            opacity: 1;
            padding: 0 0.9rem 0.9rem 0.9rem;
            border-top: 1px solid rgba(255,255,255,0.05);
        }
        
        .tip-number {
            background: var(--accent-secondary);
            color: var(--bg-color);
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.9rem;
            flex-shrink: 0;
        }
        
        .chevron {
            margin-left: auto;
            color: #64748b;
            transition: transform 0.3s ease;
            font-size: 0.8rem;
        }

        .tip-card.open .chevron {
            transform: rotate(180deg);
            color: var(--accent);
        }

        .example-text {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8rem;
            color: #94a3b8;
            margin-top: 0.8rem;
            display: block;
            border-left: 2px solid var(--accent);
            padding-left: 0.8rem;
        }
        
        .example-label {
            font-size: 0.7rem;
            text-transform: uppercase;
            color: var(--accent);
            font-weight: bold;
            letter-spacing: 1px;
            margin-bottom: 0.3rem;
            display: block;
        }

        /* Final Slide Terminal Style */
        .terminal-window {
            background: #1e1e1e;
            border-radius: 8px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            width: 800px;
            max-width: 90%;
            padding: 2rem;
            font-family: 'JetBrains Mono', monospace;
            text-align: left;
            border: 1px solid #333;
        }
        .cursor {
            display: inline-block;
            width: 10px;
            height: 1.2em;
            background-color: var(--success);
            animation: blink 1s step-end infinite;
            vertical-align: middle;
        }
        @keyframes blink { 50% { opacity: 0; } }

        /* Responsive Design - Tablets and Medium Screens */
        @media screen and (max-width: 1400px) {
            h1 { font-size: 3rem; }
            h2 { font-size: 1.8rem; }
            h3 { font-size: 1.3rem; }
            p, li { font-size: 0.95rem; }

            .slide {
                padding: 1.5rem 2rem;
                overflow-y: auto;
                justify-content: flex-start;
            }

            .split-grid {
                grid-template-columns: 1fr;
                grid-template-areas:
                    "left"
                    "right";
                gap: 1.5rem;
                height: auto;
                max-width: 100%;
            }

            .left-stack, .right-stack {
                height: auto;
                max-height: none;
                width: 100%;
            }

            .grid-item {
                padding: 1.2rem;
                max-width: 100%;
                max-height: 60vh; /* Allow more height on tablet */
            }

            .left-stack .grid-item {
                max-height: 50vh;
            }

            .code-block {
                max-height: 100%; /* Fill parent container */
                font-size: 0.8rem;
            }

            .controls {
                bottom: 1rem;
                right: 1rem;
            }

            button {
                padding: 0.6rem 1rem;
                font-size: 0.9rem;
            }

            .terminal-window {
                width: 90%;
                padding: 1.5rem;
            }
        }

        /* Responsive Design - Mobile */
        @media screen and (max-width: 768px) {
            h1 { font-size: 2.2rem; letter-spacing: -1px; }
            h2 { font-size: 1.4rem; }
            h3 { font-size: 1.1rem; letter-spacing: 1px; }
            p, li { font-size: 0.9rem; line-height: 1.6; }

            .slide {
                padding: 1rem 1.5rem;
                justify-content: flex-start;
                overflow-y: auto;
            }

            .split-grid {
                gap: 1rem;
                max-width: 100%;
            }

            .grid-item {
                padding: 1rem;
                max-height: 50vh; /* Limit height on mobile */
            }

            .left-stack .grid-item {
                max-height: 40vh;
            }

            .code-block {
                font-size: 0.75rem;
                padding: 0.8rem;
                max-height: 100%; /* Fill parent container */
            }

            .tips-grid {
                grid-template-columns: 1fr;
                gap: 0.8rem;
                max-height: 70vh;
            }

            .tip-header {
                padding: 0.7rem;
                gap: 0.6rem;
            }

            .tip-card.open .tip-body {
                padding: 0 0.7rem 0.7rem 0.7rem;
            }

            .controls {
                bottom: 0.5rem;
                right: 0.5rem;
                gap: 0.5rem;
            }

            button {
                padding: 0.5rem 0.8rem;
                font-size: 0.85rem;
            }

            .terminal-window {
                width: 95%;
                padding: 1rem;
                font-size: 0.85rem;
            }

            .tag {
                font-size: 0.7rem;
                padding: 0.2rem 0.6rem;
                margin-right: 0.5rem;
            }

            .grid-title {
                font-size: 0.75rem;
            }
        }

        /* Responsive Design - Small Mobile */
        @media screen and (max-width: 480px) {
            h1 { font-size: 1.8rem; }
            h2 { font-size: 1.2rem; margin-bottom: 1rem; }
            h3 { font-size: 1rem; }
            p, li { font-size: 0.85rem; }

            .slide {
                padding: 0.8rem 1rem;
            }

            .grid-item {
                max-height: 45vh;
            }

            .left-stack .grid-item {
                max-height: 35vh;
            }

            .code-block {
                font-size: 0.7rem;
                padding: 0.6rem;
                max-height: 100%; /* Fill parent container */
            }

            .controls {
                bottom: 0.3rem;
                right: 0.3rem;
                left: 0.3rem;
                justify-content: space-between;
            }

            button {
                padding: 0.4rem 0.7rem;
                font-size: 0.8rem;
                flex: 1;
            }

            .tip-number {
                width: 20px;
                height: 20px;
                font-size: 0.8rem;
            }

            .terminal-window {
                padding: 0.8rem;
                font-size: 0.75rem;
            }
        }

        /* Landscape Mode for Mobile Devices */
        @media screen and (max-height: 600px) and (orientation: landscape) {
            .slide {
                padding: 0.5rem 1rem;
                overflow-y: auto;
            }

            h1 { font-size: 2rem; margin-bottom: 0.5rem; }
            h2 { font-size: 1.3rem; margin-bottom: 0.8rem; }

            .code-block {
                max-height: 30vh; /* Dynamic: 30% of viewport height for landscape */
            }

            .split-grid {
                height: auto;
            }

            .controls {
                bottom: 0.3rem;
                right: 0.3rem;
            }
        }

    </style>
</head>
<body>

    <div class="progress-bar" id="progressBar" style="width: 100%;"></div>

    <div class="slide-deck">

        <!-- Slide 1: Title -->
        <div class="slide intro-slide">
            <h3>Workshop</h3>
            <h1>From Script to System</h1>
            <p style="text-align: center; font-size: 1.5rem; color: #94a3b8;">The Evolution of Prompt Engineering</p>
            <div style="margin-top: 3rem; font-size: 1rem; opacity: 0.7;">Use Right Arrow Key to Navigate </div>
        </div>

        <!-- Slide 2: The Roadmap -->
        <div class="slide intro-slide">
            <h2>The Ladder of Maturity</h2>
            <div style="display: flex; gap: 2rem; width: 100%; max-width: 1200px; margin-top: 2rem;">
                <div class="grid-item" style="flex:1; border-color: var(--accent);">
                    <strong style="color:var(--accent); font-size: 1.2rem;">Phase 1: Scripting</strong>
                    <p style="margin-top:1rem; opacity: 0.8;">The Basics</p>
                    <ul style="text-align: left; padding-left: 1.5rem; margin-top: 1rem;">
                        <li>L1: Zero-Shot</li>
                        <li>L2: Few-Shot</li>
                        <li>L3: Chain of Thought</li>
                        <li>L4: Persona</li>
                    </ul>
                </div>
                <div class="grid-item" style="flex:1; border-color: var(--accent-secondary);">
                    <strong style="color:var(--accent-secondary); font-size: 1.2rem;">Phase 2: Engineering</strong>
                    <p style="margin-top:1rem; opacity: 0.8;">Architecture</p>
                    <ul style="text-align: left; padding-left: 1.5rem; margin-top: 1rem;">
                        <li>L5: Reflection</li>
                        <li>L6: Tree of Thoughts</li>
                        <li>L7: Decomposition</li>
                    </ul>
                </div>
                <div class="grid-item" style="flex:1; border-color: var(--success);">
                    <strong style="color:var(--success); font-size: 1.2rem;">Phase 3: Singularity</strong>
                    <p style="margin-top:1rem; opacity: 0.8;">Meta-Prompting</p>
                    <ul style="text-align: left; padding-left: 1.5rem; margin-top: 1rem;">
                        <li>L8: Meta-Prompts</li>
                    </ul>
                </div>
            </div>
            <div style="margin-top: 2rem; padding: 1rem; border: 1px dashed #64748b; border-radius: 8px;">
                Task: Process <code>stats.csv</code> (Flow ID, Tx Frames, Rx Frames) and compute loss percentage.
            </div>
        </div>

        <!-- Slide 3: Level 1 - Zero Shot -->
        <div class="slide">
            <h2><span class="tag phase1">Phase 1</span>Level 1: The "Zero-Shot"</h2>
            <div class="split-grid">
                <!-- Right Stack (First in DOM for reveal logic) -->
                <div class="right-stack">
                     <!-- Result (Hidden) -->
                    <div class="grid-item result-box fragment visible">
                        <span class="grid-title">The Code Result</span>
                        <div class="code-block"><span class="keyword">import</span> csv

<span class="comment"># Assumes perfect integers</span>
<span class="keyword">with</span> open(<span class="string">'stats.csv'</span>, 'r') as file:
    reader = csv.DictReader(file)
    
    <span class="keyword">for</span> row in reader:
        flow_id = row['Flow ID']
        
        <span class="keyword">if</span> flow_id in [<span class="string">'Flow 2'</span>, <span class="string">'Flow 3'</span>, <span class="string">'Flow 4'</span>]:
            tx_frames = float(row[<span class="string">'Tx Frames'</span>])
            rx_frames = float(row[<span class="string">'Rx Frames'</span>])
            
            loss = (rx_frames - tx_frames) / tx_frames * 100
            
            <span class="keyword">print</span>(f<span class="string">"{flow_id}: {loss:.2f}%"</span>)</div>
                    </div>
                </div>

                <!-- Left Stack -->
                <div class="left-stack">
                     <!-- Concept -->
                    <div class="grid-item concept-box">
                        <span class="grid-title">Concept</span>
                        <p>Asking the model to perform a task with <strong>no examples, no context, and no constraints</strong>. You are relying entirely on the model's training data assumptions.</p>
                    </div>

                    <!-- Prompt -->
                    <div class="grid-item prompt-box">
                        <span class="grid-title">The Prompt</span>
                        <div class="code-block">Write a python script to read a csv file called 'stats.csv' calculate the total loss by looking at Tx Frames and Rx Frames.
I want you to calculate loss as (rx - tx) / tx * 100 and print the result for all Flow 2, Flow3 and Flow 4.
We will have multiple columns but the relevant columns are Flow ID, Tx Frames, Rx Frames.
Return only the python code without any explanation or comments.</div>
                    </div>

                    <!-- Reflection (Hidden) -->
                    <div class="grid-item reflection-box fragment visible">
                        <span class="grid-title">Reflection &amp; Analysis</span>
                        <p style="color: var(--danger);"><strong>Status: Fragile</strong></p>
                        <ul style="margin-top: 0.5rem; padding-left: 1.2rem; font-size: 0.9rem;">
                            <li>Benefit: Extremely fast generation.</li>
                            <li>Flaw: Crashes immediately if 'Tx Frames' or 'Rx Frames' contain non-numeric values.</li>
                            <li>Flaw: No file handling (File Not Found crash).</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Slide 4: Level 2 - Few Shot -->
        <div class="slide">
            <h2><span class="tag phase1">Phase 1</span>Level 2: The "Few-Shot"</h2>
            <div class="split-grid">
                 <!-- Right Stack -->
                <div class="right-stack">
                    <!-- Result (Hidden) -->
                    <div class="grid-item result-box fragment visible">
                        <span class="grid-title">The Code Result</span>
                        <div class="code-block"><span class="keyword">import</span> csv

<span class="keyword">with</span> open(<span class="string">'stats.csv'</span>, <span class="string">'r'</span>) <span class="keyword">as</span> file:
    csv_reader = csv.DictReader(file)

    <span class="keyword">for</span> row <span class="keyword">in</span> csv_reader:
        flow_id = row[<span class="string">'Flow ID'</span>]

        <span class="keyword">if</span> flow_id <span class="keyword">in</span> [<span class="string">'Flow 2'</span>, <span class="string">'Flow 3'</span>, <span class="string">'Flow 4'</span>]:
            tx_frames = row[<span class="string">'Tx Frames'</span>]
            rx_frames = row[<span class="string">'Rx Frames'</span>]

            <span class="keyword">if</span> rx_frames == <span class="string">'N/A'</span> <span class="keyword">or</span> tx_frames == <span class="string">'N/A'</span>:
                <span class="keyword">print</span>(f<span class="string">"{flow_id}: Loss = N/A (missing data)"</span>)
            <span class="keyword">else</span>:
                tx = float(tx_frames)
                rx = float(rx_frames)

                <span class="keyword">if</span> tx == 0:
                    <span class="keyword">print</span>(f<span class="string">"{flow_id}: Loss = N/A (Tx Frames is 0)"</span>)
                <span class="keyword">else</span>:
                    loss = (tx - rx) / tx * 100
                    <span class="keyword">print</span>(f<span class="string">"{flow_id}: Loss = {loss:.2f}%"</span>)</div>
                    </div>
                </div>

                <!-- Left Stack -->
                <div class="left-stack">
                    <!-- Concept -->
                    <div class="grid-item concept-box">
                        <span class="grid-title">Concept</span>
                        <p>Providing <strong>examples (shots)</strong> of the input data and the desired output format. This guides the model's pattern recognition engine to handle data formatting.</p>
                    </div>

                    <!-- Prompt -->
                    <div class="grid-item prompt-box">
                        <span class="grid-title">The Prompt</span>
                        <div class="code-block">Write a python script to read a csv file called 'stats.csv' 
Calculate the total loss by looking at Tx Frames and Rx Frames.
I want you to calculate loss as (tx - rx) / tx * 100 and print the result for all Flow 2, Flow3 and Flow 4.
We will have multiple columns but the relevant columns are Flow ID, Tx Frames, Rx Frames.

Its a messy csv
Here is how my csv looks like partially:
"Flow ID","Tx Frames","Rx Frames"
"Flow 1",1000,1000,....
"Flow 2",1000,"N/A",....
.
.
.
"Flow N",1000,200,....

Return only the python code without any explanation or comments.</div>
                    </div>

                     <!-- Reflection (Hidden) -->
                    <div class="grid-item reflection-box neutral fragment visible">
                        <span class="grid-title">Reflection &amp; Analysis</span>
                        <p style="color: var(--warning);"><strong>Status: Format-Aware</strong></p>
                        <ul style="margin-top: 0.5rem; padding-left: 1.2rem; font-size: 0.9rem;">
                            <li>Benefit: Handles dirty data (e.g., "N/A" values).</li>
                            <li>Flaw: Still logically brittle. What if the file is empty? What if a row is missing?</li>
                            <li>Flaw: Logic is implied, not guaranteed.</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Slide 5: Level 3 - CoT -->
        <div class="slide">
            <h2><span class="tag phase1">Phase 1</span>Level 3: Chain of Thought</h2>
            <div class="split-grid">
                <!-- Right Stack -->
                <div class="right-stack">
                    <!-- Result (Hidden) -->
                    <div class="grid-item result-box fragment visible">
                        <span class="grid-title">The Code Result</span>
                        <div class="code-block"><span class="keyword">import</span> csv,os

<span class="keyword">def</span> calculate_loss(tx, rx):
    <span class="keyword">try</span>:
        tx_val = float(tx)
        rx_val = float(rx)
        <span class="keyword">if</span> tx_val == 0:
            <span class="keyword">return</span> None
        loss = (tx_val - rx_val) / tx_val * 100
        <span class="keyword">return</span> loss
    <span class="keyword">except</span> (ValueError, TypeError):
        <span class="keyword">return</span> None

<span class="keyword">def</span> main():
    filename = <span class="string">'stats.csv'</span>
    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(filename):
        <span class="keyword">print</span>(f<span class="string">"Error: File '{filename}' not found."</span>)
        <span class="keyword">return</span>
    <span class="keyword">try</span>:
        <span class="keyword">with</span> open(filename, <span class="string">'r'</span>) <span class="keyword">as</span> file:
            csv_reader = csv.DictReader(file)
            <span class="keyword">for</span> row <span class="keyword">in</span> csv_reader:
                flow_id = row.get(<span class="string">'Flow ID'</span>, <span class="string">''</span>).strip()
                <span class="keyword">if</span> flow_id <span class="keyword">in</span> [<span class="string">'Flow 2'</span>, <span class="string">'Flow 3'</span>, <span class="string">'Flow 4'</span>]:
                    tx_frames = row.get(<span class="string">'Tx Frames'</span>, <span class="string">''</span>).strip()
                    rx_frames = row.get(<span class="string">'Rx Frames'</span>, <span class="string">''</span>).strip()
                    <span class="keyword">if</span> tx_frames.upper() == <span class="string">'N/A'</span> <span class="keyword">or</span> rx_frames.upper() == <span class="string">'N/A'</span>:
                        <span class="keyword">print</span>(f<span class="string">"{flow_id}: Unable to calculate loss (N/A values)"</span>)
                        <span class="keyword">continue</span>
                    loss = calculate_loss(tx_frames, rx_frames)
                    <span class="keyword">if</span> loss <span class="keyword">is</span> <span class="keyword">not</span> None:
                        <span class="keyword">print</span>(f<span class="string">"{flow_id}: Loss = {loss:.2f}%"</span>)
                    <span class="keyword">else</span>:
                        <span class="keyword">print</span>(f<span class="string">"{flow_id}: Unable to calculate loss (invalid data)"</span>)
    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:
        <span class="keyword">print</span>(f<span class="string">"Error reading file: {e}"</span>)

<span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:
    main()
                        </div>
                    </div>
                </div>

                 <!-- Left Stack -->
                <div class="left-stack">
                    <!-- Concept -->
                    <div class="grid-item concept-box">
                        <span class="grid-title">Concept</span>
                        <p>Forcing the model to <strong>"Show its work"</strong> or verbalize reasoning before generating code. This reduces hallucination and ensures edge cases are considered.</p>
                    </div>

                    <!-- Prompt -->
                    <div class="grid-item prompt-box">
                        <span class="grid-title">The Prompt</span>
                        <div class="code-block">Write a python script to read a csv file called 'stats.csv' 
Calculate the total loss by looking at Tx Frames and Rx Frames.
I want you to calculate loss as (tx - rx) / tx * 100 and print the result for all Flow 2, Flow3 and Flow 4.
We will have multiple columns but the relevant columns are Flow ID, Tx Frames, Rx Frames.

Its a messy csv
Here is how my csv looks like partially:
"Flow ID","Tx Frames","Rx Frames"
"Flow 1",1000,1000,....
"Flow 2",1000,"N/A",....
.
.
.
"Flow N",1000,200,....

Before coding, consider the following edge cases and handle them in your code:
1. How do we handle missing files?
2. How do we handle non-numeric rows?
3. How do we safely convert types?

Return only the python code without any explanation or comments.</div>
                    </div>

                     <!-- Reflection (Hidden) -->
                    <div class="grid-item reflection-box positive fragment visible">
                        <span class="grid-title">Reflection &amp; Analysis</span>
                        <p style="color: var(--success);"><strong>Status: Robust Logic</strong></p>
                        <ul style="margin-top: 0.5rem; padding-left: 1.2rem; font-size: 0.9rem;">
                            <li>Benefit: Handles runtime errors (Missing Files, Bad Rows).</li>
                            <li>Benefit: High reliability.</li>
                            <li>Flaw: Result is often "Spaghetti Code"hard to maintain or scale.</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Slide 6: Level 4 - Persona -->
        <div class="slide">
            <h2><span class="tag phase1">Phase 1</span>Level 4: Role + Constraints</h2>
            <div class="split-grid">
                 <!-- Right Stack -->
                 <div class="right-stack">
                    <!-- Result (Hidden) -->
                    <div class="grid-item result-box fragment visible">
                        <span class="grid-title">The Code Result</span>
                        <div class="code-block"><span class="keyword">import</span> argparse
<span class="keyword">import</span> csv
<span class="keyword">import</span> logging
<span class="keyword">import</span> sys
<span class="keyword">from</span> pathlib <span class="keyword">import</span> Path
<span class="keyword">from</span> typing <span class="keyword">import</span> Dict, List, Optional, Tuple

logging.basicConfig(
    level=logging.INFO,
    format=<span class="string">'%(asctime)s - %(levelname)s - %(message)s'</span>
)
logger = logging.getLogger(__name__)


<span class="keyword">def</span> parse_arguments() -> argparse.Namespace:
    parser = argparse.ArgumentParser(
        description=<span class="string">'Calculate packet loss from stats.csv'</span>
    )
    parser.add_argument(
        <span class="string">'--file'</span>,
        type=str,
        default=<span class="string">'stats.csv'</span>,
        help=<span class="string">'Path to the CSV file (default: stats.csv)'</span>
    )
    parser.add_argument(
        <span class="string">'--flows'</span>,
        type=str,
        nargs=<span class="string">'+'</span>,
        default=[<span class="string">'Flow 2'</span>, <span class="string">'Flow 3'</span>, <span class="string">'Flow 4'</span>],
        help=<span class="string">'Flow IDs to analyze (default: Flow 2, Flow 3, Flow 4)'</span>
    )
    <span class="keyword">return</span> parser.parse_args()


<span class="keyword">def</span> validate_file(file_path: str) -> bool:
    path = Path(file_path)
    <span class="keyword">if</span> <span class="keyword">not</span> path.exists():
        logger.error(f<span class="string">'File not found: {file_path}'</span>)
        <span class="keyword">return</span> False
    <span class="keyword">if</span> <span class="keyword">not</span> path.is_file():
        logger.error(f<span class="string">'Path is not a file: {file_path}'</span>)
        <span class="keyword">return</span> False
    <span class="keyword">return</span> True


<span class="keyword">def</span> safe_convert_to_number(value: str) -> Optional[float]:
    <span class="keyword">if</span> <span class="keyword">not</span> value <span class="keyword">or</span> value.strip() == <span class="string">''</span>:
        <span class="keyword">return</span> None

    cleaned_value = value.strip().strip(<span class="string">'"'</span>).strip(<span class="string">"'"</span>)

    <span class="keyword">if</span> cleaned_value.upper() <span class="keyword">in</span> [<span class="string">'N/A'</span>, <span class="string">'NA'</span>, <span class="string">'NULL'</span>, <span class="string">'NONE'</span>, <span class="string">'-'</span>]:
        <span class="keyword">return</span> None

    <span class="keyword">try</span>:
        <span class="keyword">return</span> float(cleaned_value)
    <span class="keyword">except</span> (ValueError, AttributeError):
        <span class="keyword">return</span> None


<span class="keyword">def</span> read_csv_data(file_path: str) -> List[Dict[str, str]]:
    data = []
    <span class="keyword">try</span>:
        <span class="keyword">with</span> open(file_path, <span class="string">'r'</span>, encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> file:
            csv_reader = csv.DictReader(file)
            <span class="keyword">for</span> row <span class="keyword">in</span> csv_reader:
                data.append(row)
        logger.info(f<span class="string">'Successfully read {len(data)} rows from {file_path}'</span>)
        <span class="keyword">return</span> data
    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:
        logger.error(f<span class="string">'Error reading CSV file: {e}'</span>)
        sys.exit(1)


<span class="keyword">def</span> calculate_loss(tx: float, rx: float) -> float:
    <span class="keyword">if</span> tx == 0:
        <span class="keyword">return</span> 0.0
    <span class="keyword">return</span> ((tx - rx) / tx) * 100


<span class="keyword">def</span> process_flow_data(
    data: List[Dict[str, str]],
    target_flows: List[str]
) -> Dict[str, Tuple[Optional[float], Optional[float], Optional[float]]]:
    results = {}

    <span class="keyword">for</span> row <span class="keyword">in</span> data:
        flow_id = row.get(<span class="string">'Flow ID'</span>, <span class="string">''</span>).strip().strip(<span class="string">'"'</span>).strip(<span class="string">"'"</span>)

        <span class="keyword">if</span> flow_id <span class="keyword">not</span> <span class="keyword">in</span> target_flows:
            <span class="keyword">continue</span>

        tx_frames_str = row.get(<span class="string">'Tx Frames'</span>, <span class="string">''</span>)
        rx_frames_str = row.get(<span class="string">'Rx Frames'</span>, <span class="string">''</span>)

        tx_frames = safe_convert_to_number(tx_frames_str)
        rx_frames = safe_convert_to_number(rx_frames_str)

        <span class="keyword">if</span> tx_frames <span class="keyword">is</span> None:
            logger.warning(f<span class="string">'{flow_id}: Tx Frames is not a valid number ({tx_frames_str})'</span>)
            results[flow_id] = (None, None, None)
            <span class="keyword">continue</span>

        <span class="keyword">if</span> rx_frames <span class="keyword">is</span> None:
            logger.warning(f<span class="string">'{flow_id}: Rx Frames is not a valid number ({rx_frames_str})'</span>)
            results[flow_id] = (tx_frames, None, None)
            <span class="keyword">continue</span>

        loss_percentage = calculate_loss(tx_frames, rx_frames)
        results[flow_id] = (tx_frames, rx_frames, loss_percentage)

    <span class="keyword">return</span> results


<span class="keyword">def</span> log_results(results: Dict[str, Tuple[Optional[float], Optional[float], Optional[float]]]) -> None:
    logger.info(<span class="string">'=' * 60</span>)
    logger.info(<span class="string">'Packet Loss Results'</span>)
    logger.info(<span class="string">'=' * 60</span>)

    <span class="keyword">for</span> flow_id, (tx, rx, loss) <span class="keyword">in</span> results.items():
        <span class="keyword">if</span> tx <span class="keyword">is</span> None:
            logger.info(f<span class="string">'{flow_id}: Unable to calculate (invalid Tx Frames)'</span>)
        <span class="keyword">elif</span> rx <span class="keyword">is</span> None:
            logger.info(f<span class="string">'{flow_id}: Unable to calculate (invalid Rx Frames)'</span>)
        <span class="keyword">else</span>:
            logger.info(f<span class="string">'{flow_id}: Tx={tx:.0f}, Rx={rx:.0f}, Loss={loss:.2f}%'</span>)

    logger.info(<span class="string">'=' * 60</span>)


<span class="keyword">def</span> main() -> None:
    args = parse_arguments()

    <span class="keyword">if</span> <span class="keyword">not</span> validate_file(args.file):
        sys.exit(1)

    data = read_csv_data(args.file)

    <span class="keyword">if</span> <span class="keyword">not</span> data:
        logger.error(<span class="string">'No data found in CSV file'</span>)
        sys.exit(1)

    results = process_flow_data(data, args.flows)

    <span class="keyword">if</span> <span class="keyword">not</span> results:
        logger.warning(f<span class="string">'No matching flows found for: {args.flows}'</span>)
        sys.exit(0)

    log_results(results)


<span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:
    main()
</div>
                    </div>
                </div>

                <!-- Left Stack -->
                <div class="left-stack">
                    <!-- Concept -->
                    <div class="grid-item concept-box">
                        <span class="grid-title">Concept</span>
                        <p>Assigning a <strong>Persona</strong> (Senior Engineer) and strict <strong>Constraints</strong> (Standards) to force production-quality structure and formatting.</p>
                    </div>

                    <!-- Prompt -->
                    <div class="grid-item prompt-box">
                        <span class="grid-title">The Prompt</span>
                        <div class="code-block">Write a python script to read a csv file called 'stats.csv' 
Calculate the total loss by looking at Tx Frames and Rx Frames.
I want you to calculate loss as (tx - rx) / tx * 100 and print the result for all Flow 2, Flow3 and Flow 4.
We will have multiple columns but the relevant columns are Flow ID, Tx Frames, Rx Frames.

Its a messy csv
Here is how my csv looks like partially:
"Flow ID","Tx Frames","Rx Frames"
"Flow 1",1000,1000,....
"Flow 2",1000,"N/A",....
.
.
.
"Flow N",1000,200,....

Before coding, consider the following edge cases and handle them in your code:
1. How do we handle missing files?
2. How do we handle non-numeric rows?
3. How do we safely convert types?

Act as a Senior Engineer.
Constraints:
1. Use `argparse` for CLI usage.
2. Use Type Hinting (PEP 484).
3. Use `logging` instead of print.
4. Modular functions.

Return only the python code without any explanation or comments.</div>
                    </div>

                    <!-- Reflection (Hidden) -->
                    <div class="grid-item reflection-box positive fragment visible">
                        <span class="grid-title">Reflection &amp; Analysis</span>
                        <p style="color: var(--success);"><strong>Status: Professional</strong></p>
                        <ul style="margin-top: 0.5rem; padding-left: 1.2rem; font-size: 0.9rem;">
                            <li>Benefit: Code is maintainable, readable, and standardized.</li>
                            <li>Benefit: Team-ready code structure.</li>
                            <li>Flaw: It might still be <strong>inefficient</strong> (e.g., loading 50GB into RAM).</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Slide 7: Level 5 - Reflection -->
        <div class="slide">
            <h2><span class="tag phase2">Phase 2</span>Level 5: Reflection (Optimization)</h2>
            <div class="split-grid">
                <!-- Right Stack -->
                <div class="right-stack">
                     <!-- Result (Hidden) -->
                    <div class="grid-item result-box fragment visible">
                        <span class="grid-title">The Code Result</span>
                        <div class="code-block"><span class="keyword">import</span> argparse
<span class="keyword">import</span> csv
<span class="keyword">import</span> logging
<span class="keyword">from</span> typing <span class="keyword">import</span> Optional, Iterator, Dict
<span class="keyword">from</span> pathlib <span class="keyword">import</span> Path

logging.basicConfig(
    level=logging.INFO,
    format=<span class="string">'%(asctime)s - %(levelname)s - %(message)s'</span>
)
logger = logging.getLogger(__name__)


<span class="keyword">def</span> parse_arguments() -> argparse.Namespace:
    parser = argparse.ArgumentParser(
        description=<span class="string">'Calculate packet loss from stats.csv'</span>
    )
    parser.add_argument(
        <span class="string">'--file'</span>,
        type=str,
        default=<span class="string">'stats.csv'</span>,
        help=<span class="string">'Path to the CSV file (default: stats.csv)'</span>
    )
    parser.add_argument(
        <span class="string">'--flows'</span>,
        nargs=<span class="string">'+'</span>,
        default=[<span class="string">'Flow 2'</span>, <span class="string">'Flow 3'</span>, <span class="string">'Flow 4'</span>],
        help=<span class="string">'Flow IDs to analyze (default: Flow 2, Flow 3, Flow 4)'</span>
    )
    <span class="keyword">return</span> parser.parse_args()


<span class="keyword">def</span> validate_file(file_path: str) -> bool:
    path = Path(file_path)
    <span class="keyword">if</span> <span class="keyword">not</span> path.exists():
        logger.error(f<span class="string">"File not found: {file_path}"</span>)
        <span class="keyword">return</span> False
    <span class="keyword">if</span> <span class="keyword">not</span> path.is_file():
        logger.error(f<span class="string">"Path is not a file: {file_path}"</span>)
        <span class="keyword">return</span> False
    <span class="keyword">return</span> True


<span class="keyword">def</span> safe_convert_to_int(value: str) -> Optional[int]:
    <span class="keyword">if</span> <span class="keyword">not</span> value:
        <span class="keyword">return</span> None

    value = value.strip().strip(<span class="string">'"'</span>).strip(<span class="string">"'"</span>)

    <span class="keyword">if</span> value.upper() <span class="keyword">in</span> (<span class="string">'N/A'</span>, <span class="string">'NA'</span>, <span class="string">'NULL'</span>, <span class="string">'NONE'</span>, <span class="string">''</span>, <span class="string">'-'</span>):
        <span class="keyword">return</span> None

    <span class="keyword">try</span>:
        <span class="keyword">return</span> int(float(value))
    <span class="keyword">except</span> (ValueError, TypeError):
        <span class="keyword">return</span> None


<span class="keyword">def</span> calculate_loss(tx_frames: Optional[int], rx_frames: Optional[int]) -> Optional[float]:
    <span class="keyword">if</span> tx_frames <span class="keyword">is</span> None <span class="keyword">or</span> rx_frames <span class="keyword">is</span> None:
        <span class="keyword">return</span> None

    <span class="keyword">if</span> tx_frames == 0:
        <span class="keyword">return</span> None

    loss = ((tx_frames - rx_frames) / tx_frames) * 100
    <span class="keyword">return</span> loss


<span class="keyword">def</span> read_csv_rows(file_path: str) -> Iterator[Dict[str, str]]:
    <span class="keyword">try</span>:
        <span class="keyword">with</span> open(file_path, <span class="string">'r'</span>, encoding=<span class="string">'utf-8'</span>, newline=<span class="string">''</span>) <span class="keyword">as</span> csvfile:
            reader = csv.DictReader(csvfile)
            <span class="keyword">for</span> row <span class="keyword">in</span> reader:
                <span class="keyword">yield</span> row
    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:
        logger.error(f<span class="string">"Error reading CSV file: {e}"</span>)
        <span class="keyword">raise</span>


<span class="keyword">def</span> process_flow_data(file_path: str, target_flows: list) -> Dict[str, Optional[float]]:
    results: Dict[str, Optional[float]] = {}
    target_flows_set = set(target_flows)

    <span class="keyword">try</span>:
        <span class="keyword">for</span> row <span class="keyword">in</span> read_csv_rows(file_path):
            flow_id = row.get(<span class="string">'Flow ID'</span>, <span class="string">''</span>).strip().strip(<span class="string">'"'</span>).strip(<span class="string">"'"</span>)

            <span class="keyword">if</span> flow_id <span class="keyword">not</span> <span class="keyword">in</span> target_flows_set:
                <span class="keyword">continue</span>

            tx_frames_str = row.get(<span class="string">'Tx Frames'</span>, <span class="string">''</span>)
            rx_frames_str = row.get(<span class="string">'Rx Frames'</span>, <span class="string">''</span>)

            tx_frames = safe_convert_to_int(tx_frames_str)
            rx_frames = safe_convert_to_int(rx_frames_str)

            loss = calculate_loss(tx_frames, rx_frames)

            results[flow_id] = loss

            <span class="keyword">if</span> loss <span class="keyword">is</span> <span class="keyword">not</span> None:
                logger.info(
                    f<span class="string">"{flow_id}: Tx={tx_frames}, Rx={rx_frames}, Loss={loss:.2f}%"</span>
                )
            <span class="keyword">else</span>:
                logger.warning(
                    f<span class="string">"{flow_id}: Unable to calculate loss (Tx={tx_frames_str}, Rx={rx_frames_str})"</span>
                )

    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:
        logger.error(f<span class="string">"Error processing flow data: {e}"</span>)
        <span class="keyword">raise</span>

    <span class="keyword">return</span> results


<span class="keyword">def</span> report_results(results: Dict[str, Optional[float]], target_flows: list) -> None:
    logger.info(<span class="string">"=" * 60</span>)
    logger.info(<span class="string">"LOSS CALCULATION RESULTS"</span>)
    logger.info(<span class="string">"=" * 60</span>)

    <span class="keyword">for</span> flow <span class="keyword">in</span> target_flows:
        <span class="keyword">if</span> flow <span class="keyword">in</span> results:
            loss = results[flow]
            <span class="keyword">if</span> loss <span class="keyword">is</span> <span class="keyword">not</span> None:
                logger.info(f<span class="string">"{flow}: {loss:.2f}% loss"</span>)
            <span class="keyword">else</span>:
                logger.info(f<span class="string">"{flow}: Unable to calculate loss (invalid data)"</span>)
        <span class="keyword">else</span>:
            logger.warning(f<span class="string">"{flow}: Not found in CSV file"</span>)

    logger.info(<span class="string">"=" * 60</span>)


<span class="keyword">def</span> main() -> None:
    args = parse_arguments()

    <span class="keyword">if</span> <span class="keyword">not</span> validate_file(args.file):
        logger.error(<span class="string">"File validation failed. Exiting."</span>)
        <span class="keyword">return</span>

    logger.info(f<span class="string">"Processing file: {args.file}"</span>)
    logger.info(f<span class="string">"Target flows: {args.flows}"</span>)

    <span class="keyword">try</span>:
        results = process_flow_data(args.file, args.flows)
        report_results(results, args.flows)
    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:
        logger.error(f<span class="string">"Fatal error during processing: {e}"</span>)


<span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:
    main()
</div>
                    </div>
                </div>

                <!-- Left Stack -->
                <div class="left-stack">
                    <!-- Concept -->
                    <div class="grid-item concept-box">
                        <span class="grid-title">Concept</span>
                        <p>Asking the model to <strong>critique its own work</strong> for performance or security flaws <em>before</em> generating the final code. This catches hidden issues.</p>
                    </div>

                    <!-- Prompt -->
                    <div class="grid-item prompt-box">
                        <span class="grid-title">The Prompt</span>
                        <div class="code-block">Write a python script to read a csv file called 'stats.csv' 
Calculate the total loss by looking at Tx Frames and Rx Frames.
I want you to calculate loss as (tx - rx) / tx * 100 and print the result for all Flow 2, Flow3 and Flow 4.
We will have multiple columns but the relevant columns are Flow ID, Tx Frames, Rx Frames.

Its a messy csv
Here is how my csv looks like partially:
"Flow ID","Tx Frames","Rx Frames"
"Flow 1",1000,1000,....
"Flow 2",1000,"N/A",....
.
.
.
"Flow N",1000,200,....

Before coding, consider the following edge cases and handle them in your code:
1. How do we handle missing files?
2. How do we handle non-numeric rows?
3. How do we safely convert types?

Act as a Senior Engineer.
Constraints:
1. Use `argparse` for CLI usage.
2. Use Type Hinting (PEP 484).
3. Use `logging` instead of print.
4. Modular functions.

Critique your initial plan for **Memory Safety** assuming a 50GB file size.
Correction: Rewrite logic to be memory efficient

Return only the python code without any explanation or comments.</div>
                    </div>

                     <!-- Reflection (Hidden) -->
                    <div class="grid-item reflection-box positive fragment visible">
                        <span class="grid-title">Reflection &amp; Analysis</span>
                        <p style="color: var(--success);"><strong>Status: Optimized</strong></p>
                        <ul style="margin-top: 0.5rem; padding-left: 1.2rem; font-size: 0.9rem;">
                            <li>Benefit: Solves infrastructure problems (OOM Errors).</li>
                            <li>Benefit: Self-correction is often better than human correction.</li>
                            <li>Note: Crucial for cloud/serverless environments.</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Slide 8: Level 6 - Tree of Thoughts -->
        <div class="slide">
            <h2><span class="tag phase2">Phase 2</span>Level 6: Tree of Thoughts</h2>
            <div class="split-grid">
                <!-- Right Stack -->
                <div class="right-stack">
                    <!-- Result (Hidden) -->
                    <div class="grid-item result-box fragment visible">
                        <span class="grid-title">The Code Result</span>
                        <div class="code-block"># Step 1: Brainstorming 3 Approaches
## Approach 1: CSV Library (Standard Library)
- Uses Python's built-in csv module
- Streams data row-by-row using DictReader
- No external dependencies
- Memory footprint: ~8KB buffer per file handle

## Approach 2: Pandas
- Feature-rich data manipulation library
- Can use chunking with `read_csv(chunksize=...)`
- Rich API for data operations
- Memory footprint: Loads entire chunk into DataFrame (typically 10,000+ rows), plus overhead for Series objects, index structures

## Approach 3: Polars
- Modern data processing library written in Rust
- Lazy evaluation with query optimization
- Can stream with `scan_csv()` and lazy operations
- Memory footprint: More efficient than Pandas but requires compilation and larger binary size

# Step 2: Pros/Cons Evaluation for Low Memory Microservice

## CSV Library (Standard Library)
**Pros:**
- Minimal memory usage - only one row in memory at a time (~1-2 KB per row)
- No external dependencies - smaller container/deployment size
- Fast startup time - no heavy library imports
- Predictable memory consumption
- Simple and transparent control flow

**Cons:**
- Manual parsing logic required
- No built-in data type inference
- Limited built-in data transformation capabilities
- Less convenient for complex operations

## Pandas
**Pros:**
- Rich ecosystem and extensive documentation
- Powerful data manipulation APIs
- Good for complex transformations

**Cons:**
- High memory overhead (3-5x the data size minimum)
- Even with chunking, each chunk loads fully into memory
- DataFrame objects have significant overhead (index, column objects, etc.)
- Slow import time (~200-500ms)
- For 50GB file, even 1000-row chunks would be problematic at scale
- Not ideal for microservices due to large library size (~100MB+)

## Polars
**Pros:**
- Better memory efficiency than Pandas (2-3x)
- Lazy evaluation can optimize query plans
- Fast execution with multi-threading
- Modern API design

**Cons:**
- Still requires loading chunks into memory
- External dependency with large binary size (~20-30MB)
- Adds complexity for simple row-by-row operations
- Less mature ecosystem than Pandas
- Overkill for simple parsing tasks

# Step 3: Winner - CSV Library (Standard Library)

**Decision: Keep the CSV Library approach**

## Rationale:

For a microservice with low memory constraints processing 50GB files, the CSV library is the clear winner because:

1. **Memory Efficiency**: Your current code already uses streaming with DictReader, which maintains O(1) memory complexity - only one row is loaded at a time. This is optimal for large files.

2. **Microservice-Friendly**: No external dependencies means:
   - Smaller Docker image size (important for microservices)
   - Faster cold starts
   - Reduced attack surface
   - No dependency management overhead

3. **Predictable Performance**: With row-by-row processing, memory usage remains constant regardless of file size. A 50GB file uses the same memory as a 50MB file.

4. **Your Use Case**: You're only tracking 3 specific flows and calculating simple loss percentages. This doesn't require the heavy machinery of Pandas or Polars.

## Minor Optimizations to Apply:

1. **Increase buffer size** for the file handle to reduce I/O syscalls
2. **Remove unnecessary string operations** in the hot path
3. **Use string interning** for Flow ID comparisons (already using upper case consistently)
4. **Early exit** once all three flows are found (optional optimization)

## Trade-offs Accepted:

- **Less convenience**: We write manual parsing logic, but for this simple use case, it's trivial
- **No fancy operations**: We can't leverage vectorized operations, but we don't need them
- **Manual type handling**: We handle type conversion ourselves, but this gives us precise control over error handling

The current code is already well-optimized for memory efficiency. The changes below add minor performance improvements while maintaining the streaming, low-memory architecture.</div>
                    </div>
                </div>

                <!-- Left Stack -->
                <div class="left-stack">
                    <!-- Concept -->
                    <div class="grid-item concept-box">
                        <span class="grid-title">Concept</span>
                        <p>Generating multiple solutions, evaluating the <strong>trade-offs</strong> (Pros/Cons) of each, and deliberately selecting the best one.</p>
                    </div>

                    <!-- Prompt -->
                    <div class="grid-item prompt-box">
                        <span class="grid-title">The Prompt</span>
                        <div class="code-block">"""For my use-case of parsing a csv file which can go upto 50GB in size,
you provided me a well structured code earlier. Now I want you to review the code for memory efficiency.

Step 1: Brainstorm 3 approaches (Pandas vs CSV Lib vs Polars).
Step 2: Evaluate Pros/Cons for a **microservice with low memory**.
Step 3: Pick the winner and change the code accordingly.

Here is the code:
{code_content}

explain why you chose the approach and tradeoffs with other approaches.
when explaining the approach do not use ``python ... ``` block. it should be plain text.
Then return the final python code within ```python ... ``` block. it should appear only once. </div>
                    </div>

                    <!-- Reflection (Hidden) -->
                    <div class="grid-item reflection-box positive fragment visible">
                        <span class="grid-title">Reflection &amp; Analysis</span>
                        <p style="color: var(--success);"><strong>Status: Justified Decision</strong></p>
                        <ul style="margin-top: 0.5rem; padding-left: 1.2rem; font-size: 0.9rem;">
                            <li>Benefit: You don't just get code; you get an architectural decision.</li>
                            <li>Benefit: Avoids "bloatware" (installing Pandas for a simple task).</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Slide 9: Level 7 - Decomposition -->
        <div class="slide">
            <h2><span class="tag phase2">Phase 2</span>Level 7: Decomposition</h2>
            <div class="split-grid">
                <!-- Right Stack -->
                <div class="right-stack">
                     <!-- Result (Hidden) -->
                    <div class="grid-item result-box fragment visible">
                        <span class="grid-title">The Code Result</span>
                        <div class="code-block"><span class="keyword">import</span> argparse
<span class="keyword">import</span> csv
<span class="keyword">import</span> logging
<span class="keyword">from</span> abc <span class="keyword">import</span> ABC, abstractmethod
<span class="keyword">from</span> dataclasses <span class="keyword">import</span> dataclass
<span class="keyword">from</span> typing <span class="keyword">import</span> Optional, Iterator, List, Set
<span class="keyword">from</span> pathlib <span class="keyword">import</span> Path
<span class="keyword">import</span> sys

<span class="comment"># Configure logging</span>
logging.basicConfig(
    level=logging.INFO,
    format=<span class="string">'%(asctime)s - %(levelname)s - %(message)s'</span>
)
logger = logging.getLogger(__name__)


<span class="comment"># ============================================================================</span>
<span class="comment"># Phase 1: Data Models (Schema)</span>
<span class="comment"># ============================================================================</span>

@dataclass(frozen=True)
<span class="keyword">class</span> TrafficFlowRecord:
    <span class="string">"""Immutable data class representing a traffic flow record."""</span>
    flow_id: str
    tx_frames: float
    rx_frames: float
    loss_percentage: float

    <span class="keyword">def</span> __post_init__(self):
        <span class="string">"""Validate the record after initialization."""</span>
        self.validate()

    <span class="keyword">def</span> validate(self) -> None:
        <span class="string">"""
        Validate the traffic flow record.

        Raises:
            ValueError: If validation fails
        """</span>
        <span class="keyword">if</span> <span class="keyword">not</span> self.flow_id <span class="keyword">or</span> <span class="keyword">not</span> self.flow_id.strip():
            <span class="keyword">raise</span> ValueError(<span class="string">"flow_id cannot be empty"</span>)

        <span class="keyword">if</span> self.tx_frames < 0:
            <span class="keyword">raise</span> ValueError(f<span class="string">"tx_frames cannot be negative: {self.tx_frames}"</span>)

        <span class="keyword">if</span> self.rx_frames < 0:
            <span class="keyword">raise</span> ValueError(f<span class="string">"rx_frames cannot be negative: {self.rx_frames}"</span>)

        <span class="keyword">if</span> self.rx_frames > self.tx_frames:
            logger.warning(
                f<span class="string">"{self.flow_id}: Rx frames ({self.rx_frames}) > Tx frames ({self.tx_frames})"</span>
            )

    <span class="keyword">def</span> __str__(self) -> str:
        <span class="string">"""Human-readable string representation."""</span>
        <span class="keyword">return</span> (
            f<span class="string">"{self.flow_id}: Tx={self.tx_frames:.0f}, Rx={self.rx_frames:.0f}, "</span>
            f<span class="string">"Loss={self.loss_percentage:.2f}%"</span>
        )


<span class="comment"># ============================================================================</span>
<span class="comment"># Phase 2: Abstract Interfaces</span>
<span class="comment"># ============================================================================</span>

<span class="keyword">class</span> DataSource(ABC):
    <span class="string">"""Abstract base class for data sources."""</span>

    @abstractmethod
    <span class="keyword">def</span> validate(self) -> bool:
        <span class="string">"""
        Validate that the data source is accessible and properly formatted.

        Returns:
            bool: True if valid, False otherwise
        """</span>
        <span class="keyword">pass</span>

    @abstractmethod
    <span class="keyword">def</span> read_records(self, target_flows: Optional[Set[str]] = None) -> Iterator[dict]:
        <span class="string">"""
        Read raw records from the data source.

        Args:
            target_flows: Optional set of flow IDs to filter

        Yields:
            dict: Raw record data
        """</span>
        <span class="keyword">pass</span>

    @abstractmethod
    <span class="keyword">def</span> get_schema(self) -> Set[str]:
        <span class="string">"""
        Get the schema (column names) of the data source.

        Returns:
            Set[str]: Set of column names
        """</span>
        <span class="keyword">pass</span>


<span class="keyword">class</span> LossCalculator:
    <span class="string">"""Business logic for calculating packet loss."""</span>

    @staticmethod
    <span class="keyword">def</span> calculate_loss(tx_frames: float, rx_frames: float) -> float:
        <span class="string">"""
        Calculate packet loss percentage.

        Args:
            tx_frames: Number of transmitted frames
            rx_frames: Number of received frames

        Returns:
            float: Loss percentage (0-100)
        """</span>
        <span class="keyword">if</span> tx_frames == 0:
            <span class="keyword">return</span> 0.0
        <span class="keyword">return</span> ((tx_frames - rx_frames) / tx_frames) * 100

    @staticmethod
    <span class="keyword">def</span> safe_convert_to_float(value: str) -> Optional[float]:
        <span class="string">"""
        Safely convert a string value to float.

        Args:
            value: String value to convert

        Returns:
            Optional[float]: Converted value or None if conversion fails
        """</span>
        <span class="keyword">if</span> <span class="keyword">not</span> value <span class="keyword">or</span> value.strip().upper() <span class="keyword">in</span> (<span class="string">'N/A'</span>, <span class="string">'NA'</span>, <span class="string">''</span>, <span class="string">'NONE'</span>, <span class="string">'NULL'</span>):
            <span class="keyword">return</span> None

        <span class="keyword">try</span>:
            cleaned_value = value.strip().replace(<span class="string">','</span>, <span class="string">''</span>)
            <span class="keyword">return</span> float(cleaned_value)
        <span class="keyword">except</span> (ValueError, AttributeError):
            <span class="keyword">return</span> None


<span class="comment"># ============================================================================</span>
<span class="comment"># Phase 3: Concrete Implementations</span>
<span class="comment"># ============================================================================</span>

<span class="keyword">class</span> CSVDataSource(DataSource):
    <span class="string">"""CSV file data source implementation with streaming support."""</span>

    REQUIRED_COLUMNS = {<span class="string">'Flow ID'</span>, <span class="string">'Tx Frames'</span>, <span class="string">'Rx Frames'</span>}

    <span class="keyword">def</span> __init__(self, file_path: str):
        <span class="string">"""
        Initialize CSV data source.

        Args:
            file_path: Path to the CSV file
        """</span>
        self.file_path = Path(file_path)
        self._schema: Optional[Set[str]] = None

    <span class="keyword">def</span> validate(self) -> bool:
        <span class="string">"""
        Validate the CSV file exists and has required columns.

        Returns:
            bool: True if valid

        Raises:
            FileNotFoundError: If file doesn't exist
            ValueError: If file is invalid
        """</span>
        <span class="keyword">if</span> <span class="keyword">not</span> self.file_path.exists():
            <span class="keyword">raise</span> FileNotFoundError(f<span class="string">"File does not exist: {self.file_path}"</span>)

        <span class="keyword">if</span> <span class="keyword">not</span> self.file_path.is_file():
            <span class="keyword">raise</span> ValueError(f<span class="string">"Path is not a file: {self.file_path}"</span>)

        <span class="comment"># Check schema</span>
        schema = self.get_schema()
        <span class="keyword">if</span> <span class="keyword">not</span> self.REQUIRED_COLUMNS.issubset(schema):
            missing = self.REQUIRED_COLUMNS - schema
            <span class="keyword">raise</span> ValueError(f<span class="string">"CSV missing required columns: {missing}"</span>)

        <span class="keyword">return</span> True

    <span class="keyword">def</span> get_schema(self) -> Set[str]:
        <span class="string">"""
        Get CSV column names.

        Returns:
            Set[str]: Set of column names
        """</span>
        <span class="keyword">if</span> self._schema <span class="keyword">is</span> <span class="keyword">not</span> None:
            <span class="keyword">return</span> self._schema

        <span class="keyword">try</span>:
            <span class="keyword">with</span> open(self.file_path, <span class="string">'r'</span>, encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> csvfile:
                reader = csv.DictReader(csvfile)
                <span class="keyword">if</span> <span class="keyword">not</span> reader.fieldnames:
                    <span class="keyword">raise</span> ValueError(<span class="string">"CSV file has no headers"</span>)
                self._schema = set(reader.fieldnames)
                <span class="keyword">return</span> self._schema
        <span class="keyword">except</span> PermissionError:
            <span class="keyword">raise</span> PermissionError(f<span class="string">"Permission denied: {self.file_path}"</span>)
        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:
            <span class="keyword">raise</span> RuntimeError(f<span class="string">"Error reading CSV schema: {e}"</span>)

    <span class="keyword">def</span> read_records(self, target_flows: Optional[Set[str]] = None) -> Iterator[dict]:
        <span class="string">"""
        Stream records from CSV file.

        Args:
            target_flows: Optional set of flow IDs to filter

        Yields:
            dict: Raw record data with keys: flow_id, tx_frames_str, rx_frames_str, row_num
        """</span>
        <span class="keyword">try</span>:
            <span class="keyword">with</span> open(self.file_path, <span class="string">'r'</span>, encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> csvfile:
                reader = csv.DictReader(csvfile)

                <span class="keyword">for</span> row_num, row <span class="keyword">in</span> enumerate(reader, start=2):
                    <span class="keyword">try</span>:
                        flow_id = row.get(<span class="string">'Flow ID'</span>, <span class="string">''</span>).strip()

                        <span class="comment"># Filter by target flows if specified</span>
                        <span class="keyword">if</span> target_flows <span class="keyword">and</span> flow_id <span class="keyword">not</span> <span class="keyword">in</span> target_flows:
                            <span class="keyword">continue</span>

                        <span class="keyword">yield</span> {
                            <span class="string">'flow_id'</span>: flow_id,
                            <span class="string">'tx_frames_str'</span>: row.get(<span class="string">'Tx Frames'</span>, <span class="string">''</span>),
                            <span class="string">'rx_frames_str'</span>: row.get(<span class="string">'Rx Frames'</span>, <span class="string">''</span>),
                            <span class="string">'row_num'</span>: row_num
                        }
                    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:
                        logger.warning(f<span class="string">"Row {row_num}: Error reading row - {e}"</span>)
                        <span class="keyword">continue</span>

        <span class="keyword">except</span> FileNotFoundError:
            logger.error(f<span class="string">"File not found: {self.file_path}"</span>)
            <span class="keyword">raise</span>
        <span class="keyword">except</span> PermissionError:
            logger.error(f<span class="string">"Permission denied: {self.file_path}"</span>)
            <span class="keyword">raise</span>
        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:
            logger.error(f<span class="string">"Unexpected error reading file: {e}"</span>)
            <span class="keyword">raise</span>


<span class="keyword">class</span> TrafficLossProcessor:
    <span class="string">"""Coordinator class that processes traffic loss from a data source."""</span>

    <span class="keyword">def</span> __init__(self, data_source: DataSource, calculator: LossCalculator):
        <span class="string">"""
        Initialize the processor.

        Args:
            data_source: Data source to read from
            calculator: Calculator for loss computation
        """</span>
        self.data_source = data_source
        self.calculator = calculator

    <span class="keyword">def</span> process_flows(
        self,
        target_flows: List[str]
    ) -> Iterator[TrafficFlowRecord]:
        <span class="string">"""
        Process flows and yield traffic flow records.

        Args:
            target_flows: List of flow IDs to process

        Yields:
            TrafficFlowRecord: Validated traffic flow records
        """</span>
        <span class="comment"># Validate data source</span>
        self.data_source.validate()

        target_flows_set = set(target_flows) <span class="keyword">if</span> target_flows <span class="keyword">else</span> None

        <span class="comment"># Stream and process records</span>
        <span class="keyword">for</span> raw_record <span class="keyword">in</span> self.data_source.read_records(target_flows_set):
            <span class="keyword">try</span>:
                flow_id = raw_record[<span class="string">'flow_id'</span>]
                row_num = raw_record[<span class="string">'row_num'</span>]

                <span class="comment"># Convert frames to floats</span>
                tx_frames = self.calculator.safe_convert_to_float(
                    raw_record[<span class="string">'tx_frames_str'</span>]
                )
                rx_frames = self.calculator.safe_convert_to_float(
                    raw_record[<span class="string">'rx_frames_str'</span>]
                )

                <span class="comment"># Validate conversions</span>
                <span class="keyword">if</span> tx_frames <span class="keyword">is</span> None:
                    logger.warning(
                        f<span class="string">"Row {row_num}: Invalid Tx Frames for {flow_id}: "</span>
                        f<span class="string">"'{raw_record['tx_frames_str']}'"</span>
                    )
                    <span class="keyword">continue</span>

                <span class="keyword">if</span> rx_frames <span class="keyword">is</span> None:
                    logger.warning(
                        f<span class="string">"Row {row_num}: Invalid Rx Frames for {flow_id}: "</span>
                        f<span class="string">"'{raw_record['rx_frames_str']}'"</span>
                    )
                    <span class="keyword">continue</span>

                <span class="comment"># Calculate loss</span>
                loss_percentage = self.calculator.calculate_loss(tx_frames, rx_frames)

                <span class="comment"># Create and yield record</span>
                record = TrafficFlowRecord(
                    flow_id=flow_id,
                    tx_frames=tx_frames,
                    rx_frames=rx_frames,
                    loss_percentage=loss_percentage
                )

                <span class="keyword">yield</span> record

            <span class="keyword">except</span> ValueError <span class="keyword">as</span> e:
                logger.warning(
                    f<span class="string">"Row {raw_record.get('row_num', '?')}: Validation error - {e}"</span>
                )
                <span class="keyword">continue</span>
            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:
                logger.warning(
                    f<span class="string">"Row {raw_record.get('row_num', '?')}: Error processing record - {e}"</span>
                )
                <span class="keyword">continue</span>

    <span class="keyword">def</span> analyze_and_report(self, target_flows: List[str]) -> None:
        <span class="string">"""
        Analyze flows and report results.

        Args:
            target_flows: List of flow IDs to analyze
        """</span>
        logger.info(f<span class="string">"Processing file: {getattr(self.data_source, 'file_path', 'unknown')}"</span>)
        logger.info(f<span class="string">"Target flows: {', '.join(target_flows)}"</span>)
        logger.info(<span class="string">"-" * 80</span>)

        results_found = False

        <span class="keyword">try</span>:
            <span class="keyword">for</span> record <span class="keyword">in</span> self.process_flows(target_flows):
                results_found = True
                logger.info(str(record))

            <span class="keyword">if</span> <span class="keyword">not</span> results_found:
                logger.warning(<span class="string">"No matching flows found in the data source"</span>)

        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:
            logger.error(f<span class="string">"Error during analysis: {e}"</span>)
            sys.exit(1)

        logger.info(<span class="string">"-" * 80</span>)
        logger.info(<span class="string">"Processing complete"</span>)


<span class="comment"># ============================================================================</span>
<span class="comment"># Phase 4: CLI Interface</span>
<span class="comment"># ============================================================================</span>

<span class="keyword">class</span> CommandLineInterface:
    <span class="string">"""Command-line interface for the traffic loss analyzer."""</span>

    @staticmethod
    <span class="keyword">def</span> parse_arguments() -> argparse.Namespace:
        <span class="string">"""
        Parse command-line arguments.

        Returns:
            argparse.Namespace: Parsed arguments
        """</span>
        parser = argparse.ArgumentParser(
            description=<span class="string">'Calculate packet loss from CSV file'</span>
        )
        parser.add_argument(
            <span class="string">'--file'</span>,
            type=str,
            default=<span class="string">'stats.csv'</span>,
            help=<span class="string">'Path to the CSV file (default: stats.csv)'</span>
        )
        parser.add_argument(
            <span class="string">'--flows'</span>,
            type=str,
            nargs=<span class="string">'+'</span>,
            default=[<span class="string">'Flow 2'</span>, <span class="string">'Flow 3'</span>, <span class="string">'Flow 4'</span>],
            help=<span class="string">'Flow IDs to analyze (default: Flow 2, Flow 3, Flow 4)'</span>
        )
        <span class="keyword">return</span> parser.parse_args()

    @staticmethod
    <span class="keyword">def</span> run() -> None:
        <span class="string">"""Run the CLI application."""</span>
        args = CommandLineInterface.parse_arguments()

        <span class="comment"># Create components</span>
        data_source = CSVDataSource(args.file)
        calculator = LossCalculator()
        processor = TrafficLossProcessor(data_source, calculator)

        <span class="comment"># Analyze flows</span>
        processor.analyze_and_report(args.flows)


<span class="keyword">def</span> main() -> None:
    <span class="string">"""Main entry point."""</span>
    CommandLineInterface.run()


<span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:
    main()

</div>
                    </div>
                </div>

                <!-- Left Stack -->
                <div class="left-stack">
                    <!-- Concept -->
                    <div class="grid-item concept-box">
                        <span class="grid-title">Concept</span>
                        <p>Breaking a large request into **structural components** (Architecture, Interface, Implementation). This moves from scripting to software engineering.</p>
                    </div>

                    <!-- Prompt -->
                    <div class="grid-item prompt-box">
                        <span class="grid-title">The Prompt</span>
                        <div class="code-block">We have a working procedural python script 'traffic_loss_calculator5.py' that calculates packet loss from a CSV file.
I want to refactor this into an object-oriented design with proper separation of concerns.

Here is the current code:
{code_content}

Refactor this code using decomposition approach with these specific phases:

Phase 1 - Define Data Models (Schema):
1. Define a `TrafficFlowRecord` dataclass to represent a single flow record with fields: flow_id, tx_frames, rx_frames, loss_percentage
2. Add validation methods in the dataclass

Phase 2 - Define Abstract Interfaces:
3. Define a `DataSource` Abstract Base Class with methods: validate(), read_records(), get_schema()
4. Define a `LossCalculator` class to handle the business logic of calculating packet loss

Phase 3 - Implement Concrete Classes:
5. Implement `CSVDataSource` inheriting from `DataSource` with streaming capability for large files
6. Implement the `TrafficLossProcessor` class that coordinates data source and calculator

Phase 4 - Maintain CLI Interface:
7. Keep the command-line interface working with argparse
8. Ensure logging is properly integrated throughout

For each phase, briefly explain your design decisions (1-2 sentences).
Then return the final refactored python code within ```python ... ``` block.</div>
                    </div>

                     <!-- Reflection (Hidden) -->
                    <div class="grid-item reflection-box positive fragment visible">
                        <span class="grid-title">Reflection &amp; Analysis</span>
                        <p style="color: var(--success);"><strong>Status: Scalable System</strong></p>
                        <ul style="margin-top: 0.5rem; padding-left: 1.2rem; font-size: 0.9rem;">
                            <li>Benefit: Modular, testable, and extensible.</li>
                            <li>Benefit: Can easily swap CSV for SQL later without breaking logic.</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Slide 10: Level 8 - Meta Prompting -->
        <div class="slide">
            <h2><span class="tag phase3">Phase 3</span>Level 8: Meta-Prompting</h2>
            <div class="split-grid">
                 <!-- Right Stack -->
                 <div class="right-stack">
                    <!-- Result (Hidden) -->
                    <div class="grid-item result-box fragment visible" style="border-color: #c084fc;">
                        <span class="grid-title">AI Generated Prompt (The Output)</span>
                        <div class="code-block" style="color: #c084fc;"># Prompt for CSV Processing Script

```
You are a senior Python engineer tasked with creating a production-grade CSV file reader for 'stats.csv'.

## Requirements:

### Core Functionality:
- Read and process 'stats.csv' in a memory-efficient manner
- Handle files of any size without loading entire dataset into memory
- Process data in chunks/streams where appropriate

### Code Quality Standards:
- Write modular, maintainable code following SOLID principles
- Use appropriate design patterns
- Include proper type hints (Python 3.8+)
- Follow PEP 8 style guidelines
- Write self-documenting code with clear variable/function names

### Edge Cases to Handle:
- File does not exist
- File is empty
- File has no data rows (only headers)
- Malformed CSV (inconsistent column counts)
- Missing or extra delimiters
- Special characters and encoding issues (UTF-8, UTF-16, etc.)
- Very large files (GB+ size)
- Empty cells/NULL values
- Headers with special characters or spaces
- Quote-enclosed fields with commas
- Different line endings (Windows/Unix/Mac)

### Required Components:
1. **Main reader class/function** with configuration options
2. **Error handling module** with custom exceptions
3. **Validation logic** for data integrity
4. **Logging mechanism** for debugging and monitoring
5. **Unit tests** covering happy path and edge cases
6. **Documentation**: docstrings and README with usage examples

### Additional Considerations:
- Use context managers for file handling
- Implement retry logic for transient failures if needed
- Consider using generators for memory efficiency
- Add performance benchmarking capabilities
- Make it easily extensible for future enhancements

Provide a complete, production-ready solution with all necessary files and clear instructions for usage.
```

---

**Alternative Shorter Version:**

```
Create a production-grade Python script to read 'stats.csv' with the following requirements:

**Code Quality**: Senior engineer level - modular architecture, type hints, SOLID principles, comprehensive documentation

**Performance**: Memory-efficient for large files using streaming/chunking

**Robustness**: Handle all edge cases including:
- Missing/corrupted files
- Encoding issues
- Malformed CSV data
- Empty/NULL values
- Large file sizes

Include: proper error handling, logging, input validation, unit tests, and usage documentation.
```</div>
                    </div>
                </div>

                <!-- Left Stack -->
                <div class="left-stack">
                    <!-- Concept -->
                    <div class="grid-item concept-box">
                        <span class="grid-title">Concept</span>
                        <p>The <strong>Force Multiplier</strong>. Instead of writing the code prompt yourself, you ask the AI to write the perfect prompt for you.</p>
                    </div>

                    <!-- Prompt -->
                    <div class="grid-item prompt-box">
                        <span class="grid-title">Your Input</span>
                        <div class="code-block">You are a prompt engineering expert.
Generate a prompt to achieve this use-case :
We have a python script to read a csv file called 'stats.csv' the code should memory efficient and handle edge cases.
The prompt should instruct that code quality should be modular senior engineer level.</div>
                    </div>

                     <!-- Reflection (Hidden) -->
                    <div class="grid-item reflection-box positive fragment visible">
                        <span class="grid-title">Reflection &amp; Analysis</span>
                        <p style="color: var(--success);"><strong>Status: The Singularity</strong></p>
                        <ul style="margin-top: 0.5rem; padding-left: 1.2rem; font-size: 0.9rem;">
                            <li>Benefit: Bridges the gap between intent ("Make it fast") and technical details ("Use multiprocessing").</li>
                            <li>Usage: Copy the output -&gt; Paste into new chat.</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Slide 11: Recap -->
        <div class="slide">
            <h2>The Cheat Sheet</h2>
            <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; width: 100%; max-width: 1400px; margin-top: 2rem;">
                <div class="grid-item" style="border-left: 4px solid var(--accent);">
                    <strong>L1: Zero-Shot</strong><br><span style="font-size:0.8rem">Syntax Only</span>
                </div>
                <div class="grid-item" style="border-left: 4px solid var(--accent);">
                    <strong>L2: Few-Shot</strong><br><span style="font-size:0.8rem">Formatting</span>
                </div>
                <div class="grid-item" style="border-left: 4px solid var(--accent);">
                    <strong>L3: CoT</strong><br><span style="font-size:0.8rem">Logic/Reasoning</span>
                </div>
                <div class="grid-item" style="border-left: 4px solid var(--accent);">
                    <strong>L4: Persona</strong><br><span style="font-size:0.8rem">Standards</span>
                </div>
                <div class="grid-item" style="border-left: 4px solid var(--accent-secondary);">
                    <strong>L5: Reflection</strong><br><span style="font-size:0.8rem">Optimization</span>
                </div>
                <div class="grid-item" style="border-left: 4px solid var(--accent-secondary);">
                    <strong>L6: Tree of Thoughts</strong><br><span style="font-size:0.8rem">Decisions</span>
                </div>
                <div class="grid-item" style="border-left: 4px solid var(--accent-secondary);">
                    <strong>L7: Decomposition</strong><br><span style="font-size:0.8rem">Architecture</span>
                </div>
                <div class="grid-item" style="border-left: 4px solid var(--success);">
                    <strong>L8: Meta</strong><br><span style="font-size:0.8rem">Prompt Generation</span>
                </div>
            </div>
        </div>

        <!-- Slide 12: Pro Tips (Interactive) -->
        <div class="slide">
            <h2 style="margin-bottom: 1rem;">Pro Tips: The Senior Mindset</h2>
            <p style="margin-bottom: 1.5rem; color: #94a3b8; font-size: 0.9rem;">Click on a card to reveal the example.</p>
            <div class="tips-grid">
                <!-- Tip 1 -->
                <div class="tip-card" onclick="toggleTip(this)">
                    <div class="tip-header">
                        <div class="tip-number">1</div>
                        <div>
                            <strong style="color:var(--accent)">Treat Prompts Like Code</strong>
                            <p style="font-size: 0.9rem; margin-top:0.3rem">Version control your best prompts (e.g., `prompts.md`).</p>
                        </div>
                        <div class="chevron"></div>
                    </div>
                    <div class="tip-body">
                        <span class="example-label">Example</span>
                        <span class="example-text">"I'm saving this 'Senior React Dev' persona to the team git repo so we all use the same coding standards."</span>
                    </div>
                </div>

                <!-- Tip 2 -->
                <div class="tip-card" onclick="toggleTip(this)">
                    <div class="tip-header">
                        <div class="tip-number">2</div>
                        <div>
                            <strong style="color:var(--accent)">Show, Don't Just Tell</strong>
                            <p style="font-size: 0.9rem; margin-top:0.3rem">Pasting one JSON example is better than explaining schema.</p>
                        </div>
                        <div class="chevron"></div>
                    </div>
                    <div class="tip-body">
                        <span class="example-label">Example</span>
                        <span class="example-text">Instead of "Return a nested user object", paste:<br><code>{"user": {"id": 123, "role": "admin"}}</code></span>
                    </div>
                </div>

                <!-- Tip 3 -->
                <div class="tip-card" onclick="toggleTip(this)">
                    <div class="tip-header">
                        <div class="tip-number">3</div>
                        <div>
                            <strong style="color:var(--accent-secondary)">Ask for Architecture First</strong>
                            <p style="font-size: 0.9rem; margin-top:0.3rem">"Propose 3 approaches (SQL vs NoSQL) and critique them."</p>
                        </div>
                        <div class="chevron"></div>
                    </div>
                    <div class="tip-body">
                        <span class="example-label">Example</span>
                        <span class="example-text">"Before coding, propose 3 DBs for a high-read system. Critique each based on AWS cost."</span>
                    </div>
                </div>

                <!-- Tip 4 -->
                <div class="tip-card" onclick="toggleTip(this)">
                    <div class="tip-header">
                        <div class="tip-number">4</div>
                        <div>
                            <strong style="color:var(--accent-secondary)">Use Constraints</strong>
                            <p style="font-size: 0.9rem; margin-top:0.3rem">Explicitly tell the AI what NOT to do.</p>
                        </div>
                        <div class="chevron"></div>
                    </div>
                    <div class="tip-body">
                        <span class="example-label">Example</span>
                        <span class="example-text">"Constraint: Do NOT use the 'requests' library. Use the standard 'http.client' only."</span>
                    </div>
                </div>

                <!-- Tip 5 -->
                <div class="tip-card" onclick="toggleTip(this)">
                    <div class="tip-header">
                        <div class="tip-number">5</div>
                        <div>
                            <strong style="color:var(--success)">Tests Before Implementation</strong>
                            <p style="font-size: 0.9rem; margin-top:0.3rem">Ask the AI to write Unit Tests first. Code will be robust.</p>
                        </div>
                        <div class="chevron"></div>
                    </div>
                    <div class="tip-body">
                        <span class="example-label">Example</span>
                        <span class="example-text">"Write 5 pytest cases for a date parser (including leap years). THEN write the code to pass them."</span>
                    </div>
                </div>

                <!-- Tip 6 -->
                <div class="tip-card" onclick="toggleTip(this)">
                    <div class="tip-header">
                        <div class="tip-number">6</div>
                        <div>
                            <strong style="color:var(--success)">Meta-Prompt for Unknowns</strong>
                            <p style="font-size: 0.9rem; margin-top:0.3rem">"I know JS. Explain this Rust code like I'm a Senior JS dev."</p>
                        </div>
                        <div class="chevron"></div>
                    </div>
                    <div class="tip-body">
                        <span class="example-label">Example</span>
                        <span class="example-text">"I am a Python dev. What context do you need from me to write the best possible Go web server?"</span>
                    </div>
                </div>

                <!-- Tip 7 -->
                <div class="tip-card" style="border-color: rgba(251, 191, 36, 0.3);" onclick="toggleTip(this)">
                    <div class="tip-header">
                        <div class="tip-number" style="background: var(--warning);">7</div>
                        <div>
                            <strong style="color:var(--warning)">Use XML Delimiters</strong>
                            <p style="font-size: 0.9rem; margin-top:0.3rem">Wrap data in tags to prevent prompt injection.</p>
                        </div>
                         <div class="chevron"></div>
                    </div>
                     <div class="tip-body">
                        <span class="example-label">Example</span>
                        <span class="example-text">"Analyze the text enclosed in tags: &lt;user_input&gt; [Messy Data] &lt;/user_input&gt;"</span>
                    </div>
                </div>

                <!-- Tip 8 -->
                <div class="tip-card" style="border-color: rgba(248, 113, 113, 0.3);" onclick="toggleTip(this)">
                    <div class="tip-header">
                        <div class="tip-number" style="background: var(--danger);">8</div>
                        <div>
                            <strong style="color:var(--danger)">Know Your Model</strong>
                            <p style="font-size: 0.9rem; margin-top:0.3rem">Reasoning models (o1) think automatically. Don't ask them to.</p>
                        </div>
                         <div class="chevron"></div>
                    </div>
                     <div class="tip-body">
                        <span class="example-label">Example</span>
                        <span class="example-text">"For o1/o3: Just state the problem. <br>For GPT-4: Explicitly ask 'Think step-by-step'."</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Slide 13: The Final Prompt (Thank You) -->
        <div class="slide intro-slide active">
            <h1 style="font-size: 3rem; margin-bottom: 2rem;">The Final Prompt</h1>
            <div class="terminal-window">
                <div style="color: #888; margin-bottom: 1rem;">// workshop_finale.py</div>
                <div><span style="color: var(--accent);">user@workshop:~$</span> run_meta_prompt --tone="grateful" --audience="devs"</div>
                <br>
                <div style="color: var(--success);">AI Agent is typing...</div>
                <br>
                <div>"You now have the tools to evolve from a Scripter to an Architect. The prompt is your compiler. Go build something impossible."</div>
                <br>
                <div style="margin-top: 1rem;">
                    <span style="color: var(--accent-secondary);">Status:</span> Session Complete.<br>
                    <span style="color: var(--accent-secondary);">Next Step:</span> <span class="cursor"></span>
                </div>
            </div>
            <p style="margin-top: 2rem; font-size: 1rem; opacity: 0.5;">Press Refresh to Restart</p>
        </div>

    </div>

    <div class="controls">
        <button onclick="prevSlide()"> Prev</button>
        <button onclick="nextStep()">Next </button>
        <button onclick="downloadHTML()" style="background: var(--success); color: #0f172a; margin-left: 1rem;"> Download</button>
    </div>

    <script>
        let currentSlide = 0;
        const slides = document.querySelectorAll('.slide');
        const progressBar = document.getElementById('progressBar');

        function updateSlide() {
            slides.forEach((slide, index) => {
                slide.classList.remove('active');
                if (index === currentSlide) {
                    slide.classList.add('active');
                }
            });
            // Update progress bar
            const progress = ((currentSlide + 1) / slides.length) * 100;
            progressBar.style.width = `${progress}%`;
        }

        // Modified Next Function handles Fragments first, then Slide transition
        function nextStep() {
            const activeSlide = slides[currentSlide];
            const hiddenFragments = activeSlide.querySelectorAll('.fragment:not(.visible)');

            if (hiddenFragments.length > 0) {
                // Reveal the next hidden fragment
                hiddenFragments[0].classList.add('visible');
            } else if (currentSlide < slides.length - 1) {
                // If no fragments left, go to next slide
                currentSlide++;
                updateSlide();
            }
        }

        function prevSlide() {
            const activeSlide = slides[currentSlide];
            const visibleFragments = activeSlide.querySelectorAll('.fragment.visible');

            if (visibleFragments.length > 0) {
                // Hide the last visible fragment
                visibleFragments[visibleFragments.length - 1].classList.remove('visible');
            } else if (currentSlide > 0) {
                currentSlide--;
                updateSlide();
            }
        }
        
        // Handle Tip Expansion
        function toggleTip(card) {
            // Close other cards (optional, for accordion behavior)
            /*
            const allCards = document.querySelectorAll('.tip-card');
            allCards.forEach(c => {
                if(c !== card) c.classList.remove('open');
            });
            */
            card.classList.toggle('open');
        }

        function downloadHTML() {
            const html = document.documentElement.outerHTML;
            const blob = new Blob([html], {type: 'text/html'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'prompt_workshop.html';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Keyboard navigation
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowRight' || e.key === ' ') {
                nextStep();
            } else if (e.key === 'ArrowLeft') {
                prevSlide();
            }
        });

        // Initialize
        updateSlide();
    </script>

</body></html>